###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         15/Aug/2017  23:22:49 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\ProgramData\Hardware\zigbee\Projects\zstack\ZMa #
#                          in\TI2530DB\ZMain.c                                #
#    Command line       =  -f D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\..\..\..\Tools\CC2530DB #
#                          \f8wCoord.cfg (-DCPU32MHZ -DROOT=__near_func       #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8         #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\..\..\..\Tools\CC2530DB #
#                          \f8wConfig.cfg (-DZIGBEEPRO -DSECURE=0             #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 D:\ProgramData\Hardware\zig #
#                          bee\Projects\zstack\ZMain\TI2530DB\ZMain.c -D      #
#                          ZTOOL_P1 -D MT_TASK -D MT_SYS_FUNC -D MT_ZDO_FUNC  #
#                          -D LCD_SUPPORTED=DEBUG -lC                         #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\CoordinatorEB\List\ -lA    #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\CoordinatorEB\List\        #
#                          --diag_suppress Pe001,Pa010 -o                     #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\CoordinatorEB\Obj\ -e      #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\ -I                     #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\Source\ -I              #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\ZMain\TI2530DB\   #
#                          -I D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\..\..\..\..\..\Componen #
#                          ts\hal\include\ -I D:\ProgramData\Hardware\zigbee\ #
#                          Projects\zstack\Samples\SensorSys\CC2530DB\..\..\. #
#                          .\..\..\Components\hal\target\CC2530EB\ -I         #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          mac\include\ -I D:\ProgramData\Hardware\zigbee\Pro #
#                          jects\zstack\Samples\SensorSys\CC2530DB\..\..\..\. #
#                          .\..\Components\mac\high_level\ -I                 #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          mac\low_level\srf04\ -I D:\ProgramData\Hardware\zi #
#                          gbee\Projects\zstack\Samples\SensorSys\CC2530DB\.. #
#                          \..\..\..\..\Components\mac\low_level\srf04\single #
#                          _chip\ -I D:\ProgramData\Hardware\zigbee\Projects\ #
#                          zstack\Samples\SensorSys\CC2530DB\..\..\..\..\..\C #
#                          omponents\mt\ -I D:\ProgramData\Hardware\zigbee\Pr #
#                          ojects\zstack\Samples\SensorSys\CC2530DB\..\..\..\ #
#                          ..\..\Components\osal\include\ -I                  #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          services\saddr\ -I D:\ProgramData\Hardware\zigbee\ #
#                          Projects\zstack\Samples\SensorSys\CC2530DB\..\..\. #
#                          .\..\..\Components\services\sdata\ -I              #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\af\ -I D:\ProgramData\Hardware\zigbee\Projec #
#                          ts\zstack\Samples\SensorSys\CC2530DB\..\..\..\..\. #
#                          .\Components\stack\nwk\ -I                         #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\sapi\ -I D:\ProgramData\Hardware\zigbee\Proj #
#                          ects\zstack\Samples\SensorSys\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sec\ -I                       #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\sys\ -I D:\ProgramData\Hardware\zigbee\Proje #
#                          cts\zstack\Samples\SensorSys\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\zdo\ -I                        #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          zmac\ -I D:\ProgramData\Hardware\zigbee\Projects\z #
#                          stack\Samples\SensorSys\CC2530DB\..\..\..\..\..\Co #
#                          mponents\zmac\f8w\ -Ohz --require_prototypes       #
#    List file          =  D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\CoordinatorEB\List\ZMain.l #
#                          st                                                 #
#    Object file        =  D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\CoordinatorEB\Obj\ZMain.r5 #
#                          1                                                  #
#                                                                             #
#                                                                             #
###############################################################################

D:\ProgramData\Hardware\zigbee\Projects\zstack\ZMain\TI2530DB\ZMain.c
      1          /**************************************************************************************************
      2            Filename:       ZMain.c
      3            Revised:        $Date: 2010-09-17 16:25:30 -0700 (Fri, 17 Sep 2010) $
      4            Revision:       $Revision: 23835 $ V1.0 ALD Andy
      5          
      6            Description:    Startup and shutdown code for ZStack
      7            Notes:          This version targets the Chipcon CC2530
      8          
      9          
     10            Copyright 2005-2010 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED AS IS?WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at https://aldsz.taobao.com
     39          **************************************************************************************************/
     40          
     41          /*********************************************************************
     42           * INCLUDES
     43           */
     44          
     45          #ifndef NONWK
     46          #include "AF.h"
     47          #endif
     48          #include "hal_adc.h"
     49          #include "hal_flash.h"
     50          #include "hal_lcd.h"
     51          #include "hal_led.h"
     52          #include "hal_drivers.h"
     53          #include "OnBoard.h"
     54          #include "OSAL.h"
     55          #include "OSAL_Nv.h"
     56          #include "ZComDef.h"
     57          #include "ZMAC.h" 
     58          
     59          /*********************************************************************
     60           * LOCAL FUNCTIONS
     61           */
     62          
     63          static void zmain_ext_addr( void );
     64          #if defined ZCL_KEY_ESTABLISH
     65          static void zmain_cert_init( void );
     66          #endif
     67          static void zmain_dev_info( void );
     68          static void zmain_vdd_check( void );
     69          
     70          #ifdef LCD_SUPPORTED
     71          static void zmain_lcd_init( void );
     72          #endif
     73          
     74          extern uint8 AppTitle[]; //应用程序名称
     75          
     76          /*********************************************************************
     77           * @fn      main
     78           * @brief   First function called after startup.
     79           * @return  don't care
     80           */
     81          int main( void )
     82          {
     83            // Turn off interrupts
     84            osal_int_disable( INTS_ALL );
     85          
     86            // Initialization for board related stuff such as LEDs
     87            HAL_BOARD_INIT();
     88          
     89            // Make sure supply voltage is high enough to run
     90            zmain_vdd_check();
     91          
     92            // Initialize board I/O
     93            InitBoard( OB_COLD );
     94          
     95            // Initialze HAL drivers
     96            HalDriverInit();
     97          
     98            // Initialize NV System
     99            osal_nv_init( NULL );
    100          
    101            // Initialize the MAC
    102            ZMacInit();
    103          
    104            // Determine the extended address
    105            zmain_ext_addr();
    106          
    107          #if defined ZCL_KEY_ESTABLISH
    108            // Initialize the Certicom certificate information.
    109            zmain_cert_init();
    110          #endif
    111          
    112            // Initialize basic NV items
    113            zgInit();
    114          
    115          #ifndef NONWK
    116            // Since the AF isn't a task, call it's initialization routine
    117            afInit();
    118          #endif
    119          
    120            // Initialize the operating system
    121            osal_init_system();
    122          
    123            // Allow interrupts
    124            osal_int_enable( INTS_ALL );
    125          
    126            // Final board initialization
    127            InitBoard( OB_READY );
    128          
    129            // Display information about this device
    130            zmain_dev_info();
    131          
    132            /* Display the device info on the LCD */
    133          #ifdef LCD_SUPPORTED
    134            zmain_lcd_init();
    135          #endif
    136          
    137          #ifdef WDT_IN_PM1
    138            /* If WDT is used, this is a good place to enable it. */
    139            WatchDogEnable( WDTIMX );
    140          #endif
    141          
    142            osal_start_system(); // No Return from here
    143          
    144            return 0;  // Shouldn't get here.
    145          } // main()
    146          
    147          /*********************************************************************
    148           * @fn      zmain_vdd_check
    149           * @brief   Check if the Vdd is OK to run the processor.
    150           * @return  Return if Vdd is ok; otherwise, flash LED, then reset
    151           *********************************************************************/
    152          static void zmain_vdd_check( void )
    153          {
    154            uint8 cnt = 16;
    155            
    156            do {
    157              while (!HalAdcCheckVdd(VDD_MIN_RUN));
                             ^
Error[Pe223]: function "HalAdcCheckVdd" declared implicitly

      while (!HalAdcCheckVdd(VDD_MIN_RUN));
                             ^
"D:\ProgramData\Hardware\zigbee\Projects\zstack\ZMain\TI2530DB\ZMain.c",157  Error[Pe020]: 
          identifier "VDD_MIN_RUN" is undefined
    158            } while (--cnt);
    159          }
    160          
    161          /**************************************************************************************************
    162           * @fn          zmain_ext_addr
    163           *
    164           * @brief       Execute a prioritized search for a valid extended address and write the results
    165           *              into the OSAL NV system for use by the system. Temporary address not saved to NV.
    166           *
    167           * input parameters
    168           *
    169           * None.
    170           *
    171           * output parameters
    172           *
    173           * None.
    174           *
    175           * @return      None.
    176           **************************************************************************************************
    177           */
    178          static void zmain_ext_addr(void)
    179          {
    180            uint8 nullAddr[Z_EXTADDR_LEN] = {0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF};
    181            uint8 writeNV = TRUE;
    182          
    183            // First check whether a non-erased extended address exists in the OSAL NV.
    184            if ((SUCCESS != osal_nv_item_init(ZCD_NV_EXTADDR, Z_EXTADDR_LEN, NULL))  ||
    185                (SUCCESS != osal_nv_read(ZCD_NV_EXTADDR, 0, Z_EXTADDR_LEN, aExtendedAddress)) ||
    186                (osal_memcmp(aExtendedAddress, nullAddr, Z_EXTADDR_LEN)))
    187            {
    188              // Attempt to read the extended address from the location on the lock bits page
    189              // where the programming tools know to reserve it.
    190              HalFlashRead(HAL_FLASH_IEEE_PAGE, HAL_FLASH_IEEE_OSET, aExtendedAddress, Z_EXTADDR_LEN);
    191          
    192              if (osal_memcmp(aExtendedAddress, nullAddr, Z_EXTADDR_LEN))
    193              {
    194                // Attempt to read the extended address from the designated location in the Info Page.
    195                if (!osal_memcmp((uint8 *)(P_INFOPAGE+HAL_INFOP_IEEE_OSET), nullAddr, Z_EXTADDR_LEN))
    196                {
    197                  osal_memcpy(aExtendedAddress, (uint8 *)(P_INFOPAGE+HAL_INFOP_IEEE_OSET), Z_EXTADDR_LEN);
    198                }
    199                else  // No valid extended address was found.
    200                {
    201                  uint8 idx;
    202                  
    203          #if !defined ( NV_RESTORE )
    204                  writeNV = FALSE;  // Make this a temporary IEEE address
    205          #endif
    206          
    207                  /* Attempt to create a sufficiently random extended address for expediency.
    208                   * Note: this is only valid/legal in a test environment and
    209                   *       must never be used for a commercial product.
    210                   */
    211                  for (idx = 0; idx < (Z_EXTADDR_LEN - 2);)
    212                  {
    213                    uint16 randy = osal_rand();
    214                    aExtendedAddress[idx++] = LO_UINT16(randy);
    215                    aExtendedAddress[idx++] = HI_UINT16(randy);
    216                  }
    217                  // Next-to-MSB identifies ZigBee devicetype.
    218          #if ZG_BUILD_COORDINATOR_TYPE && !ZG_BUILD_JOINING_TYPE
    219                  aExtendedAddress[idx++] = 0x10;
    220          #elif ZG_BUILD_RTRONLY_TYPE
    221                  aExtendedAddress[idx++] = 0x20;
    222          #else
    223                  aExtendedAddress[idx++] = 0x30;
    224          #endif
    225                  // MSB has historical signficance.
    226                  aExtendedAddress[idx] = 0xF8;
    227                }
    228              }
    229          
    230              if (writeNV)
    231              {
    232                (void)osal_nv_write(ZCD_NV_EXTADDR, 0, Z_EXTADDR_LEN, aExtendedAddress);
    233              }
    234            }
    235          
    236            // Set the MAC PIB extended address according to results from above.
    237            (void)ZMacSetReq(MAC_EXTENDED_ADDRESS, aExtendedAddress);
    238          }
    239          
    240          #if defined ZCL_KEY_ESTABLISH
    241          /**************************************************************************************************
    242           * @fn          zmain_cert_init
    243           *
    244           * @brief       Initialize the Certicom certificate information.
    245           *
    246           * input parameters
    247           *
    248           * None.
    249           *
    250           * output parameters
    251           *
    252           * None.
    253           *
    254           * @return      None.
    255           **************************************************************************************************
    256           */
    257          static void zmain_cert_init(void)
    258          {
    259            uint8 certData[ZCL_KE_IMPLICIT_CERTIFICATE_LEN];
    260            uint8 nullData[ZCL_KE_IMPLICIT_CERTIFICATE_LEN] = {
    261              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    262              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    263              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    264              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    265              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
    266              0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF
    267            };
    268          
    269            (void)osal_nv_item_init(ZCD_NV_IMPLICIT_CERTIFICATE, ZCL_KE_IMPLICIT_CERTIFICATE_LEN, NULL);
    270            (void)osal_nv_item_init(ZCD_NV_DEVICE_PRIVATE_KEY, ZCL_KE_DEVICE_PRIVATE_KEY_LEN, NULL);
    271          
    272            // First check whether non-null certificate data exists in the OSAL NV. To save on code space,
    273            // just use the ZCD_NV_CA_PUBLIC_KEY as the bellwether for all three.
    274            if ((SUCCESS != osal_nv_item_init(ZCD_NV_CA_PUBLIC_KEY, ZCL_KE_CA_PUBLIC_KEY_LEN, NULL))    ||
    275                (SUCCESS != osal_nv_read(ZCD_NV_CA_PUBLIC_KEY, 0, ZCL_KE_CA_PUBLIC_KEY_LEN, certData))  ||
    276                (osal_memcmp(certData, nullData, ZCL_KE_CA_PUBLIC_KEY_LEN)))
    277            {
    278              // Attempt to read the certificate data from its corresponding location on the lock bits page.
    279              HalFlashRead(HAL_FLASH_IEEE_PAGE, HAL_FLASH_CA_PUBLIC_KEY_OSET, certData,
    280                                                   ZCL_KE_CA_PUBLIC_KEY_LEN);
    281              // If the certificate data is not NULL, use it to update the corresponding NV items.
    282              if (!osal_memcmp(certData, nullData, ZCL_KE_CA_PUBLIC_KEY_LEN))
    283              {
    284                (void)osal_nv_write(ZCD_NV_CA_PUBLIC_KEY, 0, ZCL_KE_CA_PUBLIC_KEY_LEN, certData);
    285                HalFlashRead(HAL_FLASH_IEEE_PAGE, HAL_FLASH_IMPLICIT_CERT_OSET, certData,
    286                                                     ZCL_KE_IMPLICIT_CERTIFICATE_LEN);
    287                (void)osal_nv_write(ZCD_NV_IMPLICIT_CERTIFICATE, 0,
    288                                    ZCL_KE_IMPLICIT_CERTIFICATE_LEN, certData);
    289                HalFlashRead(HAL_FLASH_IEEE_PAGE, HAL_FLASH_DEV_PRIVATE_KEY_OSET, certData,
    290                                                  ZCL_KE_DEVICE_PRIVATE_KEY_LEN);
    291                (void)osal_nv_write(ZCD_NV_DEVICE_PRIVATE_KEY, 0, ZCL_KE_DEVICE_PRIVATE_KEY_LEN, certData);
    292              }
    293            }
    294          }
    295          #endif
    296          
    297          /**************************************************************************************************
    298           * @fn          zmain_dev_info
    299           *
    300           * @brief       This displays the IEEE (MSB to LSB) on the LCD.
    301           *
    302           * input parameters
    303           *
    304           * None.
    305           *
    306           * output parameters
    307           *
    308           * None.
    309           *
    310           * @return      None.
    311           **************************************************************************************************
    312           */
    313          static void zmain_dev_info(void)
    314          {
    315          #ifdef LCD_SUPPORTED
    316            uint8 i;
    317            uint8 *xad;
    318            uint8 lcd_buf[Z_EXTADDR_LEN*2+1];
    319          
    320            // Display the extended address.
    321            xad = aExtendedAddress + Z_EXTADDR_LEN - 1;
    322          
    323            for (i = 0; i < Z_EXTADDR_LEN*2; xad--)
    324            {
    325              uint8 ch;
    326              ch = (*xad >> 4) & 0x0F;
    327              lcd_buf[i++] = ch + (( ch < 10 ) ? '0' : '7');
    328              ch = *xad & 0x0F;
    329              lcd_buf[i++] = ch + (( ch < 10 ) ? '0' : '7');
    330            }
    331            lcd_buf[Z_EXTADDR_LEN*2] = '\0';
    332            
    333            //DrawRectFill(0 ,0 ,128,128,GREEN);//背景色
    334            DrawRectFill(3 ,20 ,122,106,WHITE); //显示窗口
    335             
    336            Color    = BLACK; //前景色
    337            Color_BK = GREEN; //背景色
    338            LCD_write_EN_string(64-7*osal_strlen((char *)AppTitle)/2,3,AppTitle); //显示标题
    339            
    340            Color    = BLACK; //前景色
    341            Color_BK = WHITE; //背景色
    342            HalLcdWriteString( "IEEE: ", HAL_LCD_LINE_3 );
    343            Color    = BLUE;                    
    344            HalLcdWriteString( (char*)lcd_buf, HAL_LCD_LINE_4 );
    345            
    346            Color    = RED; 
    347            LCD_write_CN_string(9, 95, "深圳市安联德科技");
    348            Color    = BLACK; 
    349            LCD_write_CN_string(9, 110, "诚信立足");
    350            Color    = MAGENTA; 
    351            LCD_write_CN_string(63,110, "创新致远");  
    352          #endif
    353          }
    354          
    355          #ifdef LCD_SUPPORTED
    356          /*********************************************************************
    357           * @fn      zmain_lcd_init
    358           * @brief   Initialize LCD at start up.
    359           * @return  none
    360           *********************************************************************/
    361          static void zmain_lcd_init ( void )
    362          {
    363          #ifdef SERIAL_DEBUG_SUPPORTED
    364            {
    365              HalLcdWriteString( "TexasInstruments", HAL_LCD_LINE_1 );
    366          
    367          #if defined( MT_MAC_FUNC )
    368          #if defined( ZDO_COORDINATOR )
    369                HalLcdWriteString( "MAC-MT Coord", HAL_LCD_LINE_2 );
    370          #else
    371                HalLcdWriteString( "MAC-MT Device", HAL_LCD_LINE_2 );
    372          #endif // ZDO
    373          #elif defined( MT_NWK_FUNC )
    374          #if defined( ZDO_COORDINATOR )
    375                HalLcdWriteString( "NWK Coordinator", HAL_LCD_LINE_2 );
    376          #else
    377                HalLcdWriteString( "NWK Device", HAL_LCD_LINE_2 );
    378          #endif // ZDO
    379          #endif // MT_FUNC
    380            }
    381          #endif // SERIAL_DEBUG_SUPPORTED
    382          }
    383          #endif
    384          
    385          /*********************************************************************
    386          *********************************************************************/

Errors: 2
Warnings: none
