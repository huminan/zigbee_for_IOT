###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         15/Aug/2017  23:22:39 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\ProgramData\Hardware\zigbee\Components\mt\MT_AF #
#                          .c                                                 #
#    Command line       =  -f D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\..\..\..\Tools\CC2530DB #
#                          \f8wCoord.cfg (-DCPU32MHZ -DROOT=__near_func       #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8         #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\..\..\..\Tools\CC2530DB #
#                          \f8wConfig.cfg (-DZIGBEEPRO -DSECURE=0             #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=FALSE -DPOLL_RATE=1000        #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 D:\ProgramData\Hardware\zig #
#                          bee\Components\mt\MT_AF.c -D ZTOOL_P1 -D MT_TASK   #
#                          -D MT_SYS_FUNC -D MT_ZDO_FUNC -D                   #
#                          LCD_SUPPORTED=DEBUG -lC D:\ProgramData\Hardware\zi #
#                          gbee\Projects\zstack\Samples\SensorSys\CC2530DB\Co #
#                          ordinatorEB\List\ -lA D:\ProgramData\Hardware\zigb #
#                          ee\Projects\zstack\Samples\SensorSys\CC2530DB\Coor #
#                          dinatorEB\List\ --diag_suppress Pe001,Pa010 -o     #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\CoordinatorEB\Obj\ -e      #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\ -I                     #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\Source\ -I              #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\ZMain\TI2530DB\   #
#                          -I D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\..\..\..\..\..\Componen #
#                          ts\hal\include\ -I D:\ProgramData\Hardware\zigbee\ #
#                          Projects\zstack\Samples\SensorSys\CC2530DB\..\..\. #
#                          .\..\..\Components\hal\target\CC2530EB\ -I         #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          mac\include\ -I D:\ProgramData\Hardware\zigbee\Pro #
#                          jects\zstack\Samples\SensorSys\CC2530DB\..\..\..\. #
#                          .\..\Components\mac\high_level\ -I                 #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          mac\low_level\srf04\ -I D:\ProgramData\Hardware\zi #
#                          gbee\Projects\zstack\Samples\SensorSys\CC2530DB\.. #
#                          \..\..\..\..\Components\mac\low_level\srf04\single #
#                          _chip\ -I D:\ProgramData\Hardware\zigbee\Projects\ #
#                          zstack\Samples\SensorSys\CC2530DB\..\..\..\..\..\C #
#                          omponents\mt\ -I D:\ProgramData\Hardware\zigbee\Pr #
#                          ojects\zstack\Samples\SensorSys\CC2530DB\..\..\..\ #
#                          ..\..\Components\osal\include\ -I                  #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          services\saddr\ -I D:\ProgramData\Hardware\zigbee\ #
#                          Projects\zstack\Samples\SensorSys\CC2530DB\..\..\. #
#                          .\..\..\Components\services\sdata\ -I              #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\af\ -I D:\ProgramData\Hardware\zigbee\Projec #
#                          ts\zstack\Samples\SensorSys\CC2530DB\..\..\..\..\. #
#                          .\Components\stack\nwk\ -I                         #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\sapi\ -I D:\ProgramData\Hardware\zigbee\Proj #
#                          ects\zstack\Samples\SensorSys\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sec\ -I                       #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\sys\ -I D:\ProgramData\Hardware\zigbee\Proje #
#                          cts\zstack\Samples\SensorSys\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\zdo\ -I                        #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          zmac\ -I D:\ProgramData\Hardware\zigbee\Projects\z #
#                          stack\Samples\SensorSys\CC2530DB\..\..\..\..\..\Co #
#                          mponents\zmac\f8w\ -Ohz --require_prototypes       #
#    List file          =  D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\CoordinatorEB\List\MT_AF.l #
#                          st                                                 #
#    Object file        =  D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\CoordinatorEB\Obj\MT_AF.r5 #
#                          1                                                  #
#                                                                             #
#                                                                             #
###############################################################################

D:\ProgramData\Hardware\zigbee\Components\mt\MT_AF.c
      1          /**************************************************************************************************
      2            Filename:       MT_AF.c
      3            Revised:        $Date: 2010-01-08 16:52:37 -0800 (Fri, 08 Jan 2010) $
      4            Revision:       $Revision: 21471 $
      5          
      6          
      7            Description:    MonitorTest functions for the AF layer.
      8          
      9          
     10            Copyright 2007-2010 Texas Instruments Incorporated. All rights reserved.
     11          
     12            IMPORTANT: Your use of this Software is limited to those specific rights
     13            granted under the terms of a software license agreement between the user
     14            who downloaded the software, his/her employer (which must be your employer)
     15            and Texas Instruments Incorporated (the "License").  You may not use this
     16            Software unless you agree to abide by the terms of the License. The License
     17            limits your use, and you acknowledge, that the Software may not be modified,
     18            copied or distributed unless embedded on a Texas Instruments microcontroller
     19            or used solely and exclusively in conjunction with a Texas Instruments radio
     20            frequency transceiver, which is integrated into your product.  Other than for
     21            the foregoing purpose, you may not use, reproduce, copy, prepare derivative
     22            works of, modify, distribute, perform, display or sell this Software and/or
     23            its documentation for any purpose.
     24          
     25            YOU FURTHER ACKNOWLEDGE AND AGREE THAT THE SOFTWARE AND DOCUMENTATION ARE
     26            PROVIDED “AS IS” WITHOUT WARRANTY OF ANY KIND, EITHER EXPRESS OR IMPLIED,
     27            INCLUDING WITHOUT LIMITATION, ANY WARRANTY OF MERCHANTABILITY, TITLE,
     28            NON-INFRINGEMENT AND FITNESS FOR A PARTICULAR PURPOSE. IN NO EVENT SHALL
     29            TEXAS INSTRUMENTS OR ITS LICENSORS BE LIABLE OR OBLIGATED UNDER CONTRACT,
     30            NEGLIGENCE, STRICT LIABILITY, CONTRIBUTION, BREACH OF WARRANTY, OR OTHER
     31            LEGAL EQUITABLE THEORY ANY DIRECT OR INDIRECT DAMAGES OR EXPENSES
     32            INCLUDING BUT NOT LIMITED TO ANY INCIDENTAL, SPECIAL, INDIRECT, PUNITIVE
     33            OR CONSEQUENTIAL DAMAGES, LOST PROFITS OR LOST DATA, COST OF PROCUREMENT
     34            OF SUBSTITUTE GOODS, TECHNOLOGY, SERVICES, OR ANY CLAIMS BY THIRD PARTIES
     35            (INCLUDING BUT NOT LIMITED TO ANY DEFENSE THEREOF), OR OTHER SIMILAR COSTS.
     36          
     37            Should you have any questions regarding your right to use this Software,
     38            contact Texas Instruments Incorporated at www.TI.com.
     39          
     40          **************************************************************************************************/
     41          
     42          /***************************************************************************************************
     43           * INCLUDES
     44           ***************************************************************************************************/
     45          #include "ZComDef.h"
     46          #include "OSAL.h"
     47          #include "MT.h"
     48          #include "MT_AF.h"
     49          #include "MT_ZDO.h"
     50          #include "nwk.h"
     51          #include "OnBoard.h"
     52          #include "MT_UART.h"
     53          
     54          #if defined INTER_PAN
     55          #include "stub_aps.h"
     56          #endif
     57          
     58          /***************************************************************************************************
     59           * GLOBAL VARIABLES
     60           ***************************************************************************************************/
     61          
     62          #if defined ( MT_AF_CB_FUNC )
     63          uint16 _afCallbackSub;
     64          #endif
     65          
     66          /***************************************************************************************************
     67           * LOCAL FUNCTIONS
     68           ***************************************************************************************************/
     69          void MT_AfRegister(uint8 *pBuf);
     70          void MT_AfDataRequest(uint8 *pBuf);
     71          
     72          #if defined ( ZIGBEE_SOURCE_ROUTING )
     73          void MT_AfDataRequestSrcRtg(uint8 *pBuf);
     74          #endif
     75          
     76          #if defined INTER_PAN
     77          static void MT_AfInterPanCtl(uint8 *pBuf);
     78          #endif
     79          
     80          /***************************************************************************************************
     81           * @fn      MT_afCommandProcessing
     82           *
     83           * @brief   Process all the AF commands that are issued by test tool
     84           *
     85           * @param   pBuf - pointer to the received buffer
     86           *
     87           * @return  status
     88           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     89          uint8 MT_AfCommandProcessing(uint8 *pBuf)
   \                     MT_AfCommandProcessing:
     90          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
     91            uint8 status = MT_RPC_SUCCESS;
   \   000005   7E00         MOV     R6,#0x0
     92          
     93            switch (pBuf[MT_RPC_POS_CMD1])
   \   000007   8A82         MOV     DPL,R2
   \   000009   8B83         MOV     DPH,R3
   \   00000B   A3           INC     DPTR
   \   00000C   A3           INC     DPTR
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   600B         JZ      ??MT_AfCommandProcessing_0
   \   000010   14           DEC     A
   \   000011   600D         JZ      ??MT_AfCommandProcessing_1
   \   000013   14           DEC     A
   \   000014   600A         JZ      ??MT_AfCommandProcessing_1
   \   000016   14           DEC     A
   \   000017   600C         JZ      ??MT_AfCommandProcessing_2
   \   000019   800F         SJMP    ??MT_AfCommandProcessing_3
     94            {
     95              case MT_AF_REGISTER:
     96                MT_AfRegister(pBuf);
   \                     ??MT_AfCommandProcessing_0:
   \   00001B                ; Setup parameters for call to function MT_AfRegister
   \   00001B   12....       LCALL   ??MT_AfRegister?relay
     97                break;
   \   00001E   800C         SJMP    ??MT_AfCommandProcessing_4
     98          
     99              case MT_AF_DATA_REQUEST:
    100              case MT_AF_DATA_REQUEST_EXT:
    101                MT_AfDataRequest(pBuf);
   \                     ??MT_AfCommandProcessing_1:
   \   000020                ; Setup parameters for call to function MT_AfDataRequest
   \   000020   12....       LCALL   ??MT_AfDataRequest?relay
    102                break;
   \   000023   8007         SJMP    ??MT_AfCommandProcessing_4
    103                
    104          #if defined ( ZIGBEE_SOURCE_ROUTING )
    105              case MT_AF_DATA_REQUEST_SRCRTG:
    106                MT_AfDataRequestSrcRtg(pBuf);
   \                     ??MT_AfCommandProcessing_2:
   \   000025                ; Setup parameters for call to function MT_AfDataRequestSrcRtg
   \   000025   12....       LCALL   ??MT_AfDataRequestSrcRtg?relay
    107                break;
   \   000028   8002         SJMP    ??MT_AfCommandProcessing_4
    108          #endif
    109                
    110          #if defined INTER_PAN
    111              case MT_AF_INTER_PAN_CTL:
    112                MT_AfInterPanCtl(pBuf);
    113                break; 
    114          #endif
    115                
    116              default:
    117                status = MT_RPC_ERR_COMMAND_ID;
   \                     ??MT_AfCommandProcessing_3:
   \   00002A   0E           INC     R6
   \   00002B   0E           INC     R6
    118                break;
    119            }
    120          
    121            return status;
   \                     ??MT_AfCommandProcessing_4:
   \   00002C   EE           MOV     A,R6
   \   00002D   F9           MOV     R1,A
   \   00002E   7F01         MOV     R7,#0x1
   \   000030   02....       LJMP    ?BANKED_LEAVE_XDATA
    122          }
    123          
    124          /***************************************************************************************************
    125           * @fn      MT_AfRegister
    126           *
    127           * @brief   Process AF Register command
    128           *
    129           * @param   pBuf - pointer to the received buffer
    130           *
    131           * @return  none
    132           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    133          void MT_AfRegister(uint8 *pBuf)
   \                     MT_AfRegister:
    134          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 1
   \   000005   74FF         MOV     A,#-0x1
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   8A..         MOV     ?V0 + 0,R2
   \   00000C   8B..         MOV     ?V0 + 1,R3
    135            uint8 cmdId;
    136            uint8 retValue = ZMemError;
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   7410         MOV     A,#0x10
   \   000016   12....       LCALL   ?Subroutine14 & 0xFFFF
    137            endPointDesc_t *epDesc;
    138          
    139            /* parse header */
    140            cmdId = pBuf[MT_RPC_POS_CMD1];
   \                     ??CrossCallReturnLabel_22:
   \   000019   F5..         MOV     ?V0 + 2,A
    141            pBuf += MT_RPC_FRAME_HDR_SZ;
    142          
    143            epDesc = (endPointDesc_t *)osal_mem_alloc(sizeof(endPointDesc_t));
   \   00001B                ; Setup parameters for call to function osal_mem_alloc
   \   00001B   7A06         MOV     R2,#0x6
   \   00001D   7B00         MOV     R3,#0x0
   \   00001F   12....       LCALL   ??osal_mem_alloc?relay
   \   000022   8A..         MOV     ?V0 + 4,R2
   \   000024   8B..         MOV     ?V0 + 5,R3
   \   000026   AE..         MOV     R6,?V0 + 4
   \   000028   AF..         MOV     R7,?V0 + 5
    144            if ( epDesc )
   \   00002A   EE           MOV     A,R6
   \   00002B   4F           ORL     A,R7
   \   00002C   6040         JZ      ??MT_AfRegister_0
    145            {
    146              epDesc->task_id = &MT_TaskID;
   \   00002E   8E82         MOV     DPL,R6
   \   000030   8F83         MOV     DPH,R7
   \   000032   A3           INC     DPTR
   \   000033   74..         MOV     A,#MT_TaskID & 0xff
   \   000035   F0           MOVX    @DPTR,A
   \   000036   A3           INC     DPTR
   \   000037   74..         MOV     A,#(MT_TaskID >> 8) & 0xff
   \   000039   F0           MOVX    @DPTR,A
    147              retValue = MT_BuildEndpointDesc( pBuf, epDesc );
   \   00003A                ; Setup parameters for call to function MT_BuildEndpointDesc
   \   00003A   EE           MOV     A,R6
   \   00003B   FC           MOV     R4,A
   \   00003C   EF           MOV     A,R7
   \   00003D   FD           MOV     R5,A
   \   00003E   E5..         MOV     A,?V0 + 0
   \   000040   2403         ADD     A,#0x3
   \   000042   FA           MOV     R2,A
   \   000043   E5..         MOV     A,?V0 + 1
   \   000045   3400         ADDC    A,#0x0
   \   000047   FB           MOV     R3,A
   \   000048   12....       LCALL   ??MT_BuildEndpointDesc?relay
   \   00004B   E9           MOV     A,R1
   \   00004C   85..82       MOV     DPL,?XSP + 0
   \   00004F   85..83       MOV     DPH,?XSP + 1
   \   000052   F0           MOVX    @DPTR,A
    148              if ( retValue == ZSuccess )
   \   000053   700F         JNZ     ??MT_AfRegister_1
    149              {
    150                retValue = afRegister( epDesc );
   \   000055                ; Setup parameters for call to function afRegister
   \   000055   EE           MOV     A,R6
   \   000056   FA           MOV     R2,A
   \   000057   EF           MOV     A,R7
   \   000058   FB           MOV     R3,A
   \   000059   12....       LCALL   ??afRegister?relay
   \   00005C   E9           MOV     A,R1
   \   00005D   85..82       MOV     DPL,?XSP + 0
   \   000060   85..83       MOV     DPH,?XSP + 1
   \   000063   F0           MOVX    @DPTR,A
    151              }
    152          
    153              if ( retValue != ZSuccess )
   \                     ??MT_AfRegister_1:
   \   000064   E0           MOVX    A,@DPTR
   \   000065   6007         JZ      ??MT_AfRegister_0
    154              {
    155                osal_mem_free( epDesc );
   \   000067                ; Setup parameters for call to function osal_mem_free
   \   000067   EE           MOV     A,R6
   \   000068   FA           MOV     R2,A
   \   000069   EF           MOV     A,R7
   \   00006A   FB           MOV     R3,A
   \   00006B   12....       LCALL   ??osal_mem_free?relay
    156              }
    157            }
    158          
    159            /* Build and send back the response */
    160            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
   \                     ??MT_AfRegister_0:
   \   00006E                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00006E   85..82       MOV     DPL,?XSP + 0
   \   000071   85..83       MOV     DPH,?XSP + 1
   \   000074   AC82         MOV     R4,DPL
   \   000076   AD83         MOV     R5,DPH
   \   000078   7B01         MOV     R3,#0x1
   \   00007A   AA..         MOV     R2,?V0 + 2
   \   00007C   7964         MOV     R1,#0x64
   \   00007E   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    161          }
   \   000081   7401         MOV     A,#0x1
   \   000083                REQUIRE ?Subroutine0
   \   000083                ; // Fall through to label ?Subroutine0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine0:
   \   000000   12....       LCALL   ?DEALLOC_XSTACK8
   \   000003   7F06         MOV     R7,#0x6
   \   000005   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine18:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   8A82         MOV     DPL,R2
   \   000003   8B83         MOV     DPH,R3
   \   000005   A3           INC     DPTR
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine14:
   \   000000   12....       LCALL   ?Subroutine18 & 0xFFFF
   \                     ??CrossCallReturnLabel_29:
   \   000003   A3           INC     DPTR
   \   000004   E0           MOVX    A,@DPTR
   \   000005   22           RET
    162          
    163          /***************************************************************************************************
    164           * @fn      MT_AfDataRequest
    165           *
    166           * @brief   Process AF Register command
    167           *
    168           * @param   pBuf - pointer to the received buffer
    169           *
    170           * @return  none
    171           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    172          void MT_AfDataRequest(uint8 *pBuf)
   \                     MT_AfDataRequest:
    173          {
   \   000000   74F2         MOV     A,#-0xe
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 14
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
    174            uint8 cmd0, cmd1, tempLen = 0;
    175            uint8 retValue = ZFailure;
   \   00000A   85..82       MOV     DPL,?XSP + 0
   \   00000D   85..83       MOV     DPH,?XSP + 1
   \   000010   7401         MOV     A,#0x1
   \   000012   12....       LCALL   ?Subroutine18 & 0xFFFF
    176            endPointDesc_t *epDesc;
    177            byte transId;
    178            afAddrType_t dstAddr;
    179            cId_t cId;
    180            byte txOpts, radius, srcEP;
    181          
    182            /* Parse header */
    183            cmd0 = pBuf[MT_RPC_POS_CMD0];
   \                     ??CrossCallReturnLabel_27:
   \   000015   E0           MOVX    A,@DPTR
   \   000016   FF           MOV     R7,A
    184            cmd1 = pBuf[MT_RPC_POS_CMD1];
   \   000017   8A82         MOV     DPL,R2
   \   000019   8B83         MOV     DPH,R3
   \   00001B   A3           INC     DPTR
   \   00001C   A3           INC     DPTR
   \   00001D   E0           MOVX    A,@DPTR
   \   00001E   FE           MOV     R6,A
    185            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   00001F   EA           MOV     A,R2
   \   000020   2403         ADD     A,#0x3
   \   000022   F5..         MOV     ?V0 + 4,A
   \   000024   EB           MOV     A,R3
   \   000025   3400         ADDC    A,#0x0
   \   000027   F5..         MOV     ?V0 + 5,A
    186          
    187            if (cmd1 == MT_AF_DATA_REQUEST_EXT)
   \   000029   7402         MOV     A,#0x2
   \   00002B   6E           XRL     A,R6
   \   00002C   7075         JNZ     ??MT_AfDataRequest_0
    188            {
    189              dstAddr.addrMode = (afAddrMode_t)*pBuf++;
   \   00002E   85..82       MOV     DPL,?V0 + 4
   \   000031   85..83       MOV     DPH,?V0 + 5
   \   000034   E0           MOVX    A,@DPTR
   \   000035   F8           MOV     R0,A
   \   000036   740A         MOV     A,#0xa
   \   000038   12....       LCALL   ?XSTACK_DISP0_8
   \   00003B   E8           MOV     A,R0
   \   00003C   12....       LCALL   ?Subroutine8 & 0xFFFF
    190          
    191              if (dstAddr.addrMode == afAddr64Bit)
   \                     ??CrossCallReturnLabel_11:
   \   00003F   7403         MOV     A,#0x3
   \   000041   68           XRL     A,R0
   \   000042   7025         JNZ     ??MT_AfDataRequest_1
    192              {
    193                (void)osal_memcpy(dstAddr.addr.extAddr, pBuf, Z_EXTADDR_LEN);
   \   000044                ; Setup parameters for call to function osal_memcpy
   \   000044   85....       MOV     ?V0 + 0,?V0 + 4
   \   000047   85....       MOV     ?V0 + 1,?V0 + 5
   \   00004A   75..00       MOV     ?V0 + 2,#0x0
   \   00004D   78..         MOV     R0,#?V0 + 0
   \   00004F   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000052   7C08         MOV     R4,#0x8
   \   000054   7D00         MOV     R5,#0x0
   \   000056   7405         MOV     A,#0x5
   \   000058   12....       LCALL   ?XSTACK_DISP0_8
   \   00005B   AA82         MOV     R2,DPL
   \   00005D   AB83         MOV     R3,DPH
   \   00005F   12....       LCALL   ??osal_memcpy?relay
   \   000062   7403         MOV     A,#0x3
   \   000064   12....       LCALL   ?DEALLOC_XSTACK8
   \   000067   800B         SJMP    ??MT_AfDataRequest_2
    194              }
    195              else
    196              {
    197                dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \                     ??MT_AfDataRequest_1:
   \   000069   12....       LCALL   ?Subroutine2 & 0xFFFF
    198              }
   \                     ??CrossCallReturnLabel_0:
   \   00006C   12....       LCALL   ?XSTACK_DISP0_8
   \   00006F   E8           MOV     A,R0
   \   000070   F0           MOVX    @DPTR,A
   \   000071   A3           INC     DPTR
   \   000072   E9           MOV     A,R1
   \   000073   F0           MOVX    @DPTR,A
    199              pBuf += Z_EXTADDR_LEN;
   \                     ??MT_AfDataRequest_2:
   \   000074   E5..         MOV     A,?V0 + 4
   \   000076   2408         ADD     A,#0x8
   \   000078   12....       LCALL   ??Subroutine22_0 & 0xFFFF
    200          
    201              dstAddr.endPoint = *pBuf++;
   \                     ??CrossCallReturnLabel_36:
   \   00007B   C0E0         PUSH    A
   \   00007D   740B         MOV     A,#0xb
   \   00007F   12....       LCALL   ?XSTACK_DISP0_8
   \   000082   D0E0         POP     A
   \   000084   12....       LCALL   ?Subroutine8 & 0xFFFF
    202              dstAddr.panId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \                     ??CrossCallReturnLabel_12:
   \   000087   12....       LCALL   ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_24:
   \   00008A   F8           MOV     R0,A
   \   00008B   740C         MOV     A,#0xc
   \   00008D   12....       LCALL   ?XSTACK_DISP0_8
   \   000090   E8           MOV     A,R0
   \   000091   F0           MOVX    @DPTR,A
   \   000092   A3           INC     DPTR
   \   000093   E9           MOV     A,R1
   \   000094   F0           MOVX    @DPTR,A
    203              pBuf += 2;
   \   000095   E5..         MOV     A,?V0 + 4
   \   000097   2402         ADD     A,#0x2
   \   000099   F5..         MOV     ?V0 + 4,A
   \   00009B   E5..         MOV     A,?V0 + 5
   \   00009D   3400         ADDC    A,#0x0
   \   00009F   F5..         MOV     ?V0 + 5,A
   \   0000A1   8031         SJMP    ??MT_AfDataRequest_3
    204            }
    205            else
    206            {
    207              /* Destination address */
    208              dstAddr.addrMode = afAddr16Bit;
   \                     ??MT_AfDataRequest_0:
   \   0000A3   740A         MOV     A,#0xa
   \   0000A5   12....       LCALL   ?XSTACK_DISP0_8
   \   0000A8   7402         MOV     A,#0x2
   \   0000AA   F0           MOVX    @DPTR,A
    209              dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   0000AB   85..82       MOV     DPL,?V0 + 4
   \   0000AE   85..83       MOV     DPH,?V0 + 5
   \   0000B1   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_1:
   \   0000B4   12....       LCALL   ?XSTACK_DISP0_8
   \   0000B7   E8           MOV     A,R0
   \   0000B8   F0           MOVX    @DPTR,A
   \   0000B9   A3           INC     DPTR
   \   0000BA   E9           MOV     A,R1
   \   0000BB   F0           MOVX    @DPTR,A
    210              pBuf += 2;
   \   0000BC   12....       LCALL   ?Subroutine10 & 0xFFFF
    211          
    212              /* Destination endpoint */
    213              dstAddr.endPoint = *pBuf++;
   \                     ??CrossCallReturnLabel_34:
   \   0000BF   C0E0         PUSH    A
   \   0000C1   740B         MOV     A,#0xb
   \   0000C3   12....       LCALL   ?XSTACK_DISP0_8
   \   0000C6   D0E0         POP     A
   \   0000C8   12....       LCALL   ?Subroutine8 & 0xFFFF
    214              dstAddr.panId = 0;
   \                     ??CrossCallReturnLabel_13:
   \   0000CB   740C         MOV     A,#0xc
   \   0000CD   12....       LCALL   ?XSTACK_DISP0_8
   \   0000D0   E4           CLR     A
   \   0000D1   F0           MOVX    @DPTR,A
   \   0000D2   A3           INC     DPTR
   \   0000D3   F0           MOVX    @DPTR,A
    215            }
    216          
    217            /* Source endpoint */
    218            srcEP = *pBuf++;
   \                     ??MT_AfDataRequest_3:
   \   0000D4   85..82       MOV     DPL,?V0 + 4
   \   0000D7   85..83       MOV     DPH,?V0 + 5
   \   0000DA   E0           MOVX    A,@DPTR
   \   0000DB   F9           MOV     R1,A
   \   0000DC   A3           INC     DPTR
   \   0000DD   8582..       MOV     ?V0 + 4,DPL
   \   0000E0   8583..       MOV     ?V0 + 5,DPH
    219            epDesc = afFindEndPointDesc( srcEP );
   \   0000E3                ; Setup parameters for call to function afFindEndPointDesc
   \   0000E3   12....       LCALL   ??afFindEndPointDesc?relay
   \   0000E6   8A..         MOV     ?V0 + 0,R2
   \   0000E8   8B..         MOV     ?V0 + 1,R3
   \   0000EA   AC..         MOV     R4,?V0 + 0
   \   0000EC   AD..         MOV     R5,?V0 + 1
    220          
    221            /* ClusterId */
    222            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   0000EE   85..82       MOV     DPL,?V0 + 4
   \   0000F1   85..83       MOV     DPH,?V0 + 5
   \   0000F4   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_9:
   \   0000F7   F5..         MOV     ?V0 + 2,A
   \   0000F9   E4           CLR     A
   \   0000FA   39           ADDC    A,R1
   \   0000FB   F5..         MOV     ?V0 + 3,A
    223            pBuf +=2;
   \   0000FD   12....       LCALL   ?Subroutine10 & 0xFFFF
    224          
    225            /* TransId */
    226            transId = *pBuf++;
   \                     ??CrossCallReturnLabel_35:
   \   000100   C0E0         PUSH    A
   \   000102   7401         MOV     A,#0x1
   \   000104   12....       LCALL   ?XSTACK_DISP0_8
   \   000107   D0E0         POP     A
   \   000109   12....       LCALL   ?Subroutine19 & 0xFFFF
    227          
    228            /* TxOption */
    229            txOpts = *pBuf++;
   \                     ??CrossCallReturnLabel_30:
   \   00010C   E0           MOVX    A,@DPTR
   \   00010D   F9           MOV     R1,A
   \   00010E   A3           INC     DPTR
    230          
    231            /* Radius */
    232            radius = *pBuf++;
   \   00010F   E0           MOVX    A,@DPTR
   \   000110   F8           MOV     R0,A
   \   000111   A3           INC     DPTR
    233          
    234            /* Length */
    235            tempLen = *pBuf++;
   \   000112   E0           MOVX    A,@DPTR
   \   000113   FA           MOV     R2,A
   \   000114   A3           INC     DPTR
   \   000115   8582..       MOV     ?V0 + 4,DPL
   \   000118   8583..       MOV     ?V0 + 5,DPH
    236          
    237            if ( epDesc == NULL )
   \   00011B   EC           MOV     A,R4
   \   00011C   4D           ORL     A,R5
   \   00011D   700A         JNZ     ??MT_AfDataRequest_4
    238            {
    239              retValue = afStatus_INVALID_PARAMETER;
   \   00011F   85..82       MOV     DPL,?XSP + 0
   \   000122   85..83       MOV     DPH,?XSP + 1
   \   000125   7402         MOV     A,#0x2
   \   000127   8044         SJMP    ??MT_AfDataRequest_5
    240            }
    241            else
    242            {
    243              retValue = AF_DataRequest( &dstAddr, epDesc, cId, tempLen, pBuf, &transId, txOpts, radius );
   \                     ??MT_AfDataRequest_4:
   \   000129                ; Setup parameters for call to function AF_DataRequest
   \   000129   E8           MOV     A,R0
   \   00012A   F5..         MOV     ?V0 + 0,A
   \   00012C   78..         MOV     R0,#?V0 + 0
   \   00012E   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000131   7402         MOV     A,#0x2
   \   000133   12....       LCALL   ?XSTACK_DISP0_8
   \   000136   8582..       MOV     ?V0 + 0,DPL
   \   000139   8583..       MOV     ?V0 + 1,DPH
   \   00013C   78..         MOV     R0,#?V0 + 0
   \   00013E   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000141   78..         MOV     R0,#?V0 + 4
   \   000143   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000146   8A..         MOV     ?V0 + 0,R2
   \   000148   75..00       MOV     ?V0 + 1,#0x0
   \   00014B   78..         MOV     R0,#?V0 + 0
   \   00014D   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000150   78..         MOV     R0,#?V0 + 2
   \   000152   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000155   740B         MOV     A,#0xb
   \   000157   12....       LCALL   ?XSTACK_DISP0_8
   \   00015A   AA82         MOV     R2,DPL
   \   00015C   AB83         MOV     R3,DPH
   \   00015E   12....       LCALL   ??AF_DataRequest?relay
   \   000161   7409         MOV     A,#0x9
   \   000163   12....       LCALL   ?DEALLOC_XSTACK8
   \   000166   E9           MOV     A,R1
   \   000167   85..82       MOV     DPL,?XSP + 0
   \   00016A   85..83       MOV     DPH,?XSP + 1
   \                     ??MT_AfDataRequest_5:
   \   00016D   F0           MOVX    @DPTR,A
    244            }
    245          
    246            if (MT_RPC_CMD_SREQ == (cmd0 & MT_RPC_CMD_TYPE_MASK))
   \   00016E   74E0         MOV     A,#-0x20
   \   000170   5F           ANL     A,R7
   \   000171   6420         XRL     A,#0x20
   \   000173   700D         JNZ     ??MT_AfDataRequest_6
    247            {
    248              MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP|(uint8)MT_RPC_SYS_AF), cmd1, 1, &retValue);
   \   000175                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000175   AC82         MOV     R4,DPL
   \   000177   AD83         MOV     R5,DPH
   \   000179   7B01         MOV     R3,#0x1
   \   00017B   EE           MOV     A,R6
   \   00017C   FA           MOV     R2,A
   \   00017D   7964         MOV     R1,#0x64
   \   00017F   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    249            }
    250          }
   \                     ??MT_AfDataRequest_6:
   \   000182   740E         MOV     A,#0xe
   \   000184   02....       LJMP    ?Subroutine0 & 0xFFFF

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine10:
   \   000000   E5..         MOV     A,?V0 + 4
   \   000002   2402         ADD     A,#0x2
   \   000004                REQUIRE ??Subroutine22_0
   \   000004                ; // Fall through to label ??Subroutine22_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine22_0:
   \   000000   F5..         MOV     ?V0 + 4,A
   \   000002   E5..         MOV     A,?V0 + 5
   \   000004   3400         ADDC    A,#0x0
   \   000006   F5..         MOV     ?V0 + 5,A
   \   000008   85..82       MOV     DPL,?V0 + 4
   \   00000B   F583         MOV     DPH,A
   \   00000D   E0           MOVX    A,@DPTR
   \   00000E   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine8:
   \   000000   12....       LCALL   ?Subroutine19 & 0xFFFF
   \                     ??CrossCallReturnLabel_31:
   \   000003   8582..       MOV     ?V0 + 4,DPL
   \   000006   8583..       MOV     ?V0 + 5,DPH
   \   000009   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine19:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   85..82       MOV     DPL,?V0 + 4
   \   000004   85..83       MOV     DPH,?V0 + 5
   \   000007   A3           INC     DPTR
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine7:
   \   000000   12....       LCALL   ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_26:
   \   000003   2400         ADD     A,#0x0
   \   000005   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine16:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   FA           MOV     R2,A
   \   000002   A3           INC     DPTR
   \   000003   E0           MOVX    A,@DPTR
   \   000004   F9           MOV     R1,A
   \   000005   EA           MOV     A,R2
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine2:
   \   000000   12....       LCALL   ?Subroutine16 & 0xFFFF
   \                     ??CrossCallReturnLabel_25:
   \   000003   F8           MOV     R0,A
   \   000004   7402         MOV     A,#0x2
   \   000006   22           RET
    251          
    252          
    253          #if defined ( ZIGBEE_SOURCE_ROUTING )
    254          
    255          /***************************************************************************************************
    256           * @fn      MT_AfDataRequestSrcRtg
    257           *
    258           * @brief   Process AF Register command
    259           *
    260           * @param   pBuf - pointer to the received buffer
    261           *
    262           * @return  none
    263           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    264          void MT_AfDataRequestSrcRtg(uint8 *pBuf)
   \                     MT_AfDataRequestSrcRtg:
    265          {
   \   000000   74EC         MOV     A,#-0x14
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 20
   \   000005                ; Auto size: 14
   \   000005   74F2         MOV     A,#-0xe
   \   000007   12....       LCALL   ?ALLOC_XSTACK8
   \   00000A   EA           MOV     A,R2
   \   00000B   FE           MOV     R6,A
   \   00000C   EB           MOV     A,R3
   \   00000D   FF           MOV     R7,A
    266            uint8 cmdId, dataLen = 0;
    267            uint8 retValue = ZFailure;
   \   00000E   85..82       MOV     DPL,?XSP + 0
   \   000011   85..83       MOV     DPH,?XSP + 1
   \   000014   7401         MOV     A,#0x1
   \   000016   12....       LCALL   ?Subroutine13 & 0xFFFF
    268            endPointDesc_t *epDesc;
    269            byte transId;
    270            afAddrType_t dstAddr;
    271            cId_t cId;
    272            byte txOpts, radius, srcEP, relayCnt;
    273            uint16 *pRelayList;
    274            uint8 i;
    275          
    276            /* parse header */
    277            cmdId = pBuf[MT_RPC_POS_CMD1];
   \                     ??CrossCallReturnLabel_19:
   \   000019   A3           INC     DPTR
   \   00001A   E0           MOVX    A,@DPTR
   \   00001B   F5..         MOV     ?V0 + 4,A
    278            pBuf += MT_RPC_FRAME_HDR_SZ;
   \   00001D   EE           MOV     A,R6
   \   00001E   2403         ADD     A,#0x3
   \   000020   0E           INC     R6
   \   000021   0E           INC     R6
   \   000022   0E           INC     R6
   \   000023   EF           MOV     A,R7
   \   000024   3400         ADDC    A,#0x0
   \   000026   FF           MOV     R7,A
    279          
    280            /* Destination address */
    281            /* Initialize the panID field to zero to avoid inter-pan */
    282            osal_memset( &dstAddr, 0, sizeof(afAddrType_t) ); 
   \   000027                ; Setup parameters for call to function osal_memset
   \   000027   7C0C         MOV     R4,#0xc
   \   000029   7D00         MOV     R5,#0x0
   \   00002B   7900         MOV     R1,#0x0
   \   00002D   7402         MOV     A,#0x2
   \   00002F   12....       LCALL   ?XSTACK_DISP0_8
   \   000032   AA82         MOV     R2,DPL
   \   000034   AB83         MOV     R3,DPH
   \   000036   12....       LCALL   ??osal_memset?relay
    283            dstAddr.addrMode = afAddr16Bit;
   \   000039   740A         MOV     A,#0xa
   \   00003B   12....       LCALL   ?XSTACK_DISP0_8
   \   00003E   7402         MOV     A,#0x2
   \   000040   F0           MOVX    @DPTR,A
    284            dstAddr.addr.shortAddr = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000041   8E82         MOV     DPL,R6
   \   000043   8F83         MOV     DPH,R7
   \   000045   12....       LCALL   ?Subroutine2 & 0xFFFF
   \                     ??CrossCallReturnLabel_2:
   \   000048   12....       LCALL   ?XSTACK_DISP0_8
   \   00004B   E8           MOV     A,R0
   \   00004C   F0           MOVX    @DPTR,A
   \   00004D   A3           INC     DPTR
   \   00004E   E9           MOV     A,R1
   \   00004F   12....       LCALL   ?Subroutine12 & 0xFFFF
    285            pBuf += 2;
    286          
    287            /* Destination endpoint */
    288            dstAddr.endPoint = *pBuf++;
   \                     ??CrossCallReturnLabel_17:
   \   000052   8E82         MOV     DPL,R6
   \   000054   8F83         MOV     DPH,R7
   \   000056   E0           MOVX    A,@DPTR
   \   000057   C0E0         PUSH    A
   \   000059   740B         MOV     A,#0xb
   \   00005B   12....       LCALL   ?XSTACK_DISP0_8
   \   00005E   D0E0         POP     A
   \   000060   12....       LCALL   ?Subroutine13 & 0xFFFF
    289          
    290            /* Source endpoint */
    291            srcEP = *pBuf++;
   \                     ??CrossCallReturnLabel_20:
   \   000063   E0           MOVX    A,@DPTR
   \   000064   F9           MOV     R1,A
   \   000065   A3           INC     DPTR
   \   000066   AE82         MOV     R6,DPL
   \   000068   AF83         MOV     R7,DPH
    292            epDesc = afFindEndPointDesc( srcEP );
   \   00006A                ; Setup parameters for call to function afFindEndPointDesc
   \   00006A   12....       LCALL   ??afFindEndPointDesc?relay
   \   00006D   8A..         MOV     ?V0 + 2,R2
   \   00006F   8B..         MOV     ?V0 + 3,R3
    293          
    294            /* ClusterId */
    295            cId = BUILD_UINT16(pBuf[0], pBuf[1]);
   \   000071   8E82         MOV     DPL,R6
   \   000073   8F83         MOV     DPH,R7
   \   000075   12....       LCALL   ?Subroutine7 & 0xFFFF
   \                     ??CrossCallReturnLabel_10:
   \   000078   F5..         MOV     ?V0 + 6,A
   \   00007A   E4           CLR     A
   \   00007B   39           ADDC    A,R1
   \   00007C   F5..         MOV     ?V0 + 7,A
    296            pBuf +=2;
   \   00007E   12....       LCALL   ?Subroutine21 & 0xFFFF
    297          
    298            /* TransId */
    299            transId = *pBuf++;
   \                     ??CrossCallReturnLabel_32:
   \   000081   8E82         MOV     DPL,R6
   \   000083   8F83         MOV     DPH,R7
   \   000085   E0           MOVX    A,@DPTR
   \   000086   C0E0         PUSH    A
   \   000088   7401         MOV     A,#0x1
   \   00008A   12....       LCALL   ?XSTACK_DISP0_8
   \   00008D   D0E0         POP     A
   \   00008F   12....       LCALL   ?Subroutine13 & 0xFFFF
    300          
    301            /* TxOption */
    302            txOpts = *pBuf++;
   \                     ??CrossCallReturnLabel_21:
   \   000092   E0           MOVX    A,@DPTR
   \   000093   F5..         MOV     ?V0 + 5,A
   \   000095   A3           INC     DPTR
    303          
    304            /* Radius */
    305            radius = *pBuf++;
   \   000096   E0           MOVX    A,@DPTR
   \   000097   F5..         MOV     ?V0 + 10,A
   \   000099   A3           INC     DPTR
    306            
    307            /* Source route relay count */
    308            relayCnt = *pBuf++;
   \   00009A   E0           MOVX    A,@DPTR
   \   00009B   F5..         MOV     ?V0 + 11,A
   \   00009D   A3           INC     DPTR
   \   00009E   AE82         MOV     R6,DPL
   \   0000A0   AF83         MOV     R7,DPH
    309            
    310            /* Convert the source route relay list */
    311            if( (pRelayList = osal_mem_alloc( relayCnt * sizeof( uint16 ))) != NULL )
   \   0000A2                ; Setup parameters for call to function osal_mem_alloc
   \   0000A2   C3           CLR     C
   \   0000A3   33           RLC     A
   \   0000A4   FA           MOV     R2,A
   \   0000A5   E4           CLR     A
   \   0000A6   33           RLC     A
   \   0000A7   FB           MOV     R3,A
   \   0000A8   12....       LCALL   ??osal_mem_alloc?relay
   \   0000AB   8A..         MOV     ?V0 + 0,R2
   \   0000AD   8B..         MOV     ?V0 + 1,R3
   \   0000AF   EA           MOV     A,R2
   \   0000B0   45..         ORL     A,?V0 + 1
   \   0000B2   7003         JNZ     $+5
   \   0000B4   02....       LJMP    ??MT_AfDataRequestSrcRtg_0 & 0xFFFF
    312            {
    313              for( i = 0; i < relayCnt; i++ )
   \   0000B7   7C00         MOV     R4,#0x0
   \   0000B9   8022         SJMP    ??MT_AfDataRequestSrcRtg_1
    314              {
    315                pRelayList[i]  = BUILD_UINT16( pBuf[0], pBuf[1] );
   \                     ??MT_AfDataRequestSrcRtg_2:
   \   0000BB   FA           MOV     R2,A
   \   0000BC   A3           INC     DPTR
   \   0000BD   E0           MOVX    A,@DPTR
   \   0000BE   F9           MOV     R1,A
   \   0000BF   EA           MOV     A,R2
   \   0000C0   2400         ADD     A,#0x0
   \   0000C2   E4           CLR     A
   \   0000C3   39           ADDC    A,R1
   \   0000C4   FB           MOV     R3,A
   \   0000C5   EC           MOV     A,R4
   \   0000C6   33           RLC     A
   \   0000C7   F8           MOV     R0,A
   \   0000C8   E4           CLR     A
   \   0000C9   33           RLC     A
   \   0000CA   F9           MOV     R1,A
   \   0000CB   E5..         MOV     A,?V0 + 0
   \   0000CD   28           ADD     A,R0
   \   0000CE   F582         MOV     DPL,A
   \   0000D0   E5..         MOV     A,?V0 + 1
   \   0000D2   39           ADDC    A,R1
   \   0000D3   F583         MOV     DPH,A
   \   0000D5   EA           MOV     A,R2
   \   0000D6   F0           MOVX    @DPTR,A
   \   0000D7   A3           INC     DPTR
   \   0000D8   EB           MOV     A,R3
   \   0000D9   12....       LCALL   ?Subroutine12 & 0xFFFF
    316                pBuf += 2;
    317              }
   \                     ??CrossCallReturnLabel_18:
   \   0000DC   0C           INC     R4
   \                     ??MT_AfDataRequestSrcRtg_1:
   \   0000DD   EC           MOV     A,R4
   \   0000DE   C3           CLR     C
   \   0000DF   95..         SUBB    A,?V0 + 11
   \   0000E1   8E82         MOV     DPL,R6
   \   0000E3   8F83         MOV     DPH,R7
   \   0000E5   E0           MOVX    A,@DPTR
   \   0000E6   40D3         JC      ??MT_AfDataRequestSrcRtg_2
    318            
    319              /* Data payload Length */
    320              dataLen = *pBuf++;
   \   0000E8   F9           MOV     R1,A
   \   0000E9   A3           INC     DPTR
   \   0000EA   AE82         MOV     R6,DPL
   \   0000EC   AF83         MOV     R7,DPH
    321          
    322              if ( epDesc == NULL )
   \   0000EE   E5..         MOV     A,?V0 + 2
   \   0000F0   45..         ORL     A,?V0 + 3
   \   0000F2   700A         JNZ     ??MT_AfDataRequestSrcRtg_3
    323              {
    324                retValue = afStatus_INVALID_PARAMETER;
   \   0000F4   85..82       MOV     DPL,?XSP + 0
   \   0000F7   85..83       MOV     DPH,?XSP + 1
   \   0000FA   7402         MOV     A,#0x2
   \   0000FC   805D         SJMP    ??MT_AfDataRequestSrcRtg_4
    325              }
    326              else
    327              {
    328                retValue = AF_DataRequestSrcRtg( &dstAddr, epDesc, cId, dataLen, pBuf, 
    329                                               &transId, txOpts, radius, relayCnt, pRelayList );
   \                     ??MT_AfDataRequestSrcRtg_3:
   \   0000FE                ; Setup parameters for call to function AF_DataRequestSrcRtg
   \   0000FE   78..         MOV     R0,#?V0 + 0
   \   000100   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000103   E5..         MOV     A,?V0 + 11
   \   000105   F5..         MOV     ?V0 + 8,A
   \   000107   78..         MOV     R0,#?V0 + 8
   \   000109   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   00010C   E5..         MOV     A,?V0 + 10
   \   00010E   F5..         MOV     ?V0 + 8,A
   \   000110   78..         MOV     R0,#?V0 + 8
   \   000112   12....       LCALL   ?PUSH_XSTACK_I_ONE
   \   000115   7405         MOV     A,#0x5
   \   000117   12....       LCALL   ?XSTACK_DISP0_8
   \   00011A   8582..       MOV     ?V0 + 8,DPL
   \   00011D   8583..       MOV     ?V0 + 9,DPH
   \   000120   78..         MOV     R0,#?V0 + 8
   \   000122   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000125   8E..         MOV     ?V0 + 8,R6
   \   000127   8F..         MOV     ?V0 + 9,R7
   \   000129   78..         MOV     R0,#?V0 + 8
   \   00012B   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00012E   89..         MOV     ?V0 + 8,R1
   \   000130   75..00       MOV     ?V0 + 9,#0x0
   \   000133   78..         MOV     R0,#?V0 + 8
   \   000135   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   000138   78..         MOV     R0,#?V0 + 6
   \   00013A   12....       LCALL   ?PUSH_XSTACK_I_TWO
   \   00013D   A9..         MOV     R1,?V0 + 5
   \   00013F   AC..         MOV     R4,?V0 + 2
   \   000141   AD..         MOV     R5,?V0 + 3
   \   000143   740E         MOV     A,#0xe
   \   000145   12....       LCALL   ?XSTACK_DISP0_8
   \   000148   AA82         MOV     R2,DPL
   \   00014A   AB83         MOV     R3,DPH
   \   00014C   12....       LCALL   ??AF_DataRequestSrcRtg?relay
   \   00014F   740C         MOV     A,#0xc
   \   000151   12....       LCALL   ?DEALLOC_XSTACK8
   \   000154   E9           MOV     A,R1
   \   000155   85..82       MOV     DPL,?XSP + 0
   \   000158   85..83       MOV     DPH,?XSP + 1
   \                     ??MT_AfDataRequestSrcRtg_4:
   \   00015B   F0           MOVX    @DPTR,A
    330              }
    331              
    332              /* Free the memory allocated */
    333              osal_mem_free( pRelayList );
   \   00015C                ; Setup parameters for call to function osal_mem_free
   \   00015C   AA..         MOV     R2,?V0 + 0
   \   00015E   AB..         MOV     R3,?V0 + 1
   \   000160   12....       LCALL   ??osal_mem_free?relay
   \   000163   8009         SJMP    ??MT_AfDataRequestSrcRtg_5
    334            }
    335            else
    336            {
    337              retValue = afStatus_MEM_FAIL;
   \                     ??MT_AfDataRequestSrcRtg_0:
   \   000165   85..82       MOV     DPL,?XSP + 0
   \   000168   85..83       MOV     DPH,?XSP + 1
   \   00016B   7410         MOV     A,#0x10
   \   00016D   F0           MOVX    @DPTR,A
    338            }
    339              
    340          
    341            /* Build and send back the response */
    342            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmdId, 1, &retValue);
   \                     ??MT_AfDataRequestSrcRtg_5:
   \   00016E                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   00016E   85..82       MOV     DPL,?XSP + 0
   \   000171   85..83       MOV     DPH,?XSP + 1
   \   000174   AC82         MOV     R4,DPL
   \   000176   AD83         MOV     R5,DPH
   \   000178   7B01         MOV     R3,#0x1
   \   00017A   AA..         MOV     R2,?V0 + 4
   \   00017C   7964         MOV     R1,#0x64
   \   00017E   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    343          }
   \   000181   740E         MOV     A,#0xe
   \   000183   12....       LCALL   ?DEALLOC_XSTACK8
   \   000186   7F0C         MOV     R7,#0xc
   \   000188   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine13:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   8E82         MOV     DPL,R6
   \   000003   8F83         MOV     DPH,R7
   \   000005   A3           INC     DPTR
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine12:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   12....       LCALL   ?Subroutine21 & 0xFFFF
   \                     ??CrossCallReturnLabel_33:
   \   000004   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine21:
   \   000000   EE           MOV     A,R6
   \   000001   2402         ADD     A,#0x2
   \   000003   0E           INC     R6
   \   000004   0E           INC     R6
   \   000005   EF           MOV     A,R7
   \   000006   3400         ADDC    A,#0x0
   \   000008   FF           MOV     R7,A
   \   000009   22           RET
    344          #endif
    345          
    346          #if defined INTER_PAN
    347          /***************************************************************************************************
    348           * @fn      MT_AfInterPanCtl
    349           *
    350           * @brief   Process the AF Inter Pan control command.
    351           *
    352           * @param   pBuf - pointer to the received buffer
    353           *
    354           * @return  none
    355           ***************************************************************************************************/
    356          static void MT_AfInterPanCtl(uint8 *pBuf)
    357          {
    358            uint8 cmd, rtrn;
    359            uint16 panId;
    360            endPointDesc_t *pEP;
    361            
    362            cmd = pBuf[MT_RPC_POS_CMD1];
    363            pBuf += MT_RPC_FRAME_HDR_SZ;
    364          
    365            switch (*pBuf++)  // Inter-pan request parameter.
    366            {
    367            case InterPanClr:
    368              rtrn = StubAPS_SetIntraPanChannel();           // Switch channel back to the NIB channel.
    369              break;
    370          
    371            case InterPanSet:
    372              rtrn = StubAPS_SetInterPanChannel(*pBuf);      // Set channel for inter-pan communication.
    373              break;
    374          
    375            case InterPanReg:
    376              if ((pEP = afFindEndPointDesc(*pBuf)))
    377              {
    378                StubAPS_RegisterApp(pEP);
    379                rtrn = SUCCESS;
    380              }
    381              else
    382              {
    383                rtrn = FAILURE;
    384              }
    385              break;
    386          
    387            case InterPanChk:
    388              panId = BUILD_UINT16(pBuf[0], pBuf[1]);
    389              rtrn = (StubAPS_InterPan(panId, pBuf[2])) ? ZSuccess : ZFailure;
    390              break;
    391          
    392            default:
    393              rtrn = afStatus_INVALID_PARAMETER;
    394              break;
    395            }
    396          
    397            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_SRSP | (uint8)MT_RPC_SYS_AF), cmd, 1, &rtrn);
    398          }
    399          #endif
    400          
    401          /***************************************************************************************************
    402           * @fn      MT_AfDataConfirm
    403           *
    404           * @brief   Process
    405           *
    406           * @param   pBuf - pointer to the received buffer
    407           *
    408           * @return  none
    409           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    410          void MT_AfDataConfirm(afDataConfirm_t *pMsg)
   \                     MT_AfDataConfirm:
    411          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 3
   \   000004   74FD         MOV     A,#-0x3
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
    412            uint8 retArray[3];
    413          
    414            retArray[0] = pMsg->hdr.status;
   \   000009   8A82         MOV     DPL,R2
   \   00000B   8B83         MOV     DPH,R3
   \   00000D   A3           INC     DPTR
   \   00000E   E0           MOVX    A,@DPTR
   \   00000F   85..82       MOV     DPL,?XSP + 0
   \   000012   85..83       MOV     DPH,?XSP + 1
   \   000015   12....       LCALL   ?Subroutine14 & 0xFFFF
    415            retArray[1] = pMsg->endpoint;
   \                     ??CrossCallReturnLabel_23:
   \   000018   C0E0         PUSH    A
   \   00001A   7401         MOV     A,#0x1
   \   00001C   12....       LCALL   ?XSTACK_DISP0_8
   \   00001F   D0E0         POP     A
   \   000021   12....       LCALL   ?Subroutine18 & 0xFFFF
    416            retArray[2] = pMsg->transID;
   \                     ??CrossCallReturnLabel_28:
   \   000024   A3           INC     DPTR
   \   000025   A3           INC     DPTR
   \   000026   E0           MOVX    A,@DPTR
   \   000027   C0E0         PUSH    A
   \   000029   7402         MOV     A,#0x2
   \   00002B   12....       LCALL   ?XSTACK_DISP0_8
   \   00002E   D0E0         POP     A
   \   000030   F0           MOVX    @DPTR,A
    417          
    418            /* Build and send back the response */
    419            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ | (uint8)MT_RPC_SYS_AF), MT_AF_DATA_CONFIRM, 3, retArray);
   \   000031                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000031   85..82       MOV     DPL,?XSP + 0
   \   000034   85..83       MOV     DPH,?XSP + 1
   \   000037   AC82         MOV     R4,DPL
   \   000039   AD83         MOV     R5,DPH
   \   00003B   7B03         MOV     R3,#0x3
   \   00003D   7A80         MOV     R2,#-0x80
   \   00003F   7944         MOV     R1,#0x44
   \   000041   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    420          }
   \   000044   7403         MOV     A,#0x3
   \   000046   12....       LCALL   ?DEALLOC_XSTACK8
   \   000049   D083         POP     DPH
   \   00004B   D082         POP     DPL
   \   00004D   02....       LJMP    ?BRET
    421          
    422          /***************************************************************************************************
    423           * @fn          MT_AfIncomingMsg
    424           *
    425           * @brief       Process the callback subscription for AF Incoming data.
    426           *
    427           * @param       pkt - Incoming AF data.
    428           *
    429           * @return      none
    430           ***************************************************************************************************/

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
    431          void MT_AfIncomingMsg(afIncomingMSGPacket_t *pMsg)
   \                     MT_AfIncomingMsg:
    432          {
   \   000000   74ED         MOV     A,#-0x13
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 19
   \   000005                ; Auto size: 0
   \   000005   8A..         MOV     ?V0 + 0,R2
   \   000007   8B..         MOV     ?V0 + 1,R3
    433            uint8 dataLen = pMsg->cmd.DataLength;  /* Length of the data section in the response packet */
   \   000009   EA           MOV     A,R2
   \   00000A   241F         ADD     A,#0x1f
   \   00000C   F582         MOV     DPL,A
   \   00000E   EB           MOV     A,R3
   \   00000F   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_46:
   \   000012   E0           MOVX    A,@DPTR
   \   000013   F5..         MOV     ?V0 + 9,A
    434            uint8 respLen = 17 + dataLen;          /* Length of the whole response packet */
   \   000015   7411         MOV     A,#0x11
   \   000017   25..         ADD     A,?V0 + 9
   \   000019   F5..         MOV     ?V0 + 10,A
    435            uint8 cmd = MT_AF_INCOMING_MSG;
   \   00001B   75..81       MOV     ?V0 + 8,#-0x7f
    436            uint8 *pRsp, *tempPtr;
    437          
    438          #if defined INTER_PAN
    439            if (StubAPS_InterPan(pMsg->srcAddr.panId, pMsg->srcAddr.endPoint))
    440            {
    441              cmd = MT_AF_INCOMING_MSG_EXT;
    442            }
    443            else
    444          #endif
    445            if (pMsg->srcAddr.addrMode == afAddr64Bit)
   \   00001E   EA           MOV     A,R2
   \   00001F   240E         ADD     A,#0xe
   \   000021   F582         MOV     DPL,A
   \   000023   EB           MOV     A,R3
   \   000024   12....       LCALL   ??Subroutine25_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_47:
   \   000027   E0           MOVX    A,@DPTR
   \   000028   6403         XRL     A,#0x3
   \   00002A   7009         JNZ     ??MT_AfIncomingMsg_0
    446            {
    447              cmd = MT_AF_INCOMING_MSG_EXT;
   \   00002C   75..82       MOV     ?V0 + 8,#-0x7e
    448            }
    449          
    450            if (cmd == MT_AF_INCOMING_MSG_EXT)
    451            {
    452              respLen += 9;
   \   00002F   7409         MOV     A,#0x9
   \   000031   25..         ADD     A,?V0 + 10
   \   000033   F5..         MOV     ?V0 + 10,A
    453            }
    454          
    455            // Attempt to allocate memory for the response packet.
    456            if ((pRsp = osal_mem_alloc(respLen)) == NULL)
   \                     ??MT_AfIncomingMsg_0:
   \   000035                ; Setup parameters for call to function osal_mem_alloc
   \   000035   85....       MOV     ?V0 + 2,?V0 + 10
   \   000038   AA..         MOV     R2,?V0 + 2
   \   00003A   7B00         MOV     R3,#0x0
   \   00003C   12....       LCALL   ??osal_mem_alloc?relay
   \   00003F   8A..         MOV     ?V0 + 2,R2
   \   000041   8B..         MOV     ?V0 + 3,R3
   \   000043   EA           MOV     A,R2
   \   000044   45..         ORL     A,?V0 + 3
   \   000046   7003         JNZ     $+5
   \   000048   02....       LJMP    ??MT_AfIncomingMsg_1 & 0xFFFF
    457            {
    458              return;
    459            }
    460            tempPtr = pRsp;
   \   00004B   AE..         MOV     R6,?V0 + 2
   \   00004D   AF..         MOV     R7,?V0 + 3
    461          
    462            /* Fill in the data */
    463          
    464            /* Group ID */
    465            *tempPtr++ = LO_UINT16(pMsg->groupId);
   \   00004F   E5..         MOV     A,?V0 + 0
   \   000051   2402         ADD     A,#0x2
   \   000053   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_14:
   \   000056   12....       LCALL   ?Subroutine4 & 0xFFFF
    466            *tempPtr++ = HI_UINT16(pMsg->groupId);
   \                     ??CrossCallReturnLabel_5:
   \   000059   8882         MOV     DPL,R0
   \   00005B   8983         MOV     DPH,R1
   \   00005D   A3           INC     DPTR
   \   00005E   12....       LCALL   ??Subroutine26_0 & 0xFFFF
    467          
    468            /* Cluster ID */
    469            *tempPtr++ = LO_UINT16(pMsg->clusterId);
   \                     ??CrossCallReturnLabel_55:
   \   000061   2404         ADD     A,#0x4
   \   000063   12....       LCALL   ?Subroutine3 & 0xFFFF
    470            *tempPtr++ = HI_UINT16(pMsg->clusterId);
   \                     ??CrossCallReturnLabel_3:
   \   000066   12....       LCALL   ?Subroutine5 & 0xFFFF
    471          
    472            if (cmd == MT_AF_INCOMING_MSG_EXT)
   \                     ??CrossCallReturnLabel_7:
   \   000069   7482         MOV     A,#-0x7e
   \   00006B   65..         XRL     A,?V0 + 8
   \   00006D   7065         JNZ     ??MT_AfIncomingMsg_2
    473            {
    474              *tempPtr++ = pMsg->srcAddr.addrMode;
   \   00006F   E5..         MOV     A,?V0 + 0
   \   000071   240E         ADD     A,#0xe
   \   000073   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_15:
   \   000076   12....       LCALL   ?Subroutine5 & 0xFFFF
    475          
    476              if (pMsg->srcAddr.addrMode == afAddr64Bit)
   \                     ??CrossCallReturnLabel_8:
   \   000079   8882         MOV     DPL,R0
   \   00007B   8983         MOV     DPH,R1
   \   00007D   E0           MOVX    A,@DPTR
   \   00007E   6403         XRL     A,#0x3
   \   000080   7026         JNZ     ??MT_AfIncomingMsg_3
    477              {
    478                (void)osal_memcpy(tempPtr, pMsg->srcAddr.addr.extAddr, Z_EXTADDR_LEN);
   \   000082                ; Setup parameters for call to function osal_memcpy
   \   000082   E5..         MOV     A,?V0 + 0
   \   000084   2406         ADD     A,#0x6
   \   000086   F5..         MOV     ?V0 + 4,A
   \   000088   E5..         MOV     A,?V0 + 1
   \   00008A   3400         ADDC    A,#0x0
   \   00008C   F5..         MOV     ?V0 + 5,A
   \   00008E   75..00       MOV     ?V0 + 6,#0x0
   \   000091   78..         MOV     R0,#?V0 + 4
   \   000093   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000096   7C08         MOV     R4,#0x8
   \   000098   7D00         MOV     R5,#0x0
   \   00009A   EE           MOV     A,R6
   \   00009B   FA           MOV     R2,A
   \   00009C   EF           MOV     A,R7
   \   00009D   FB           MOV     R3,A
   \   00009E   12....       LCALL   ??osal_memcpy?relay
   \   0000A1   7403         MOV     A,#0x3
   \   0000A3   12....       LCALL   ?DEALLOC_XSTACK8
   \   0000A6   8016         SJMP    ??MT_AfIncomingMsg_4
    479              }
    480              else
    481              {
    482                tempPtr[0] = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
   \                     ??MT_AfIncomingMsg_3:
   \   0000A8   E5..         MOV     A,?V0 + 0
   \   0000AA   2406         ADD     A,#0x6
   \   0000AC   12....       LCALL   ?Subroutine11 & 0xFFFF
   \                     ??CrossCallReturnLabel_16:
   \   0000AF   12....       LCALL   ?Subroutine17 & 0xFFFF
    483                tempPtr[1] = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
   \                     ??CrossCallReturnLabel_43:
   \   0000B2   8882         MOV     DPL,R0
   \   0000B4   8983         MOV     DPH,R1
   \   0000B6   A3           INC     DPTR
   \   0000B7   E0           MOVX    A,@DPTR
   \   0000B8   8E82         MOV     DPL,R6
   \   0000BA   8F83         MOV     DPH,R7
   \   0000BC   A3           INC     DPTR
   \   0000BD   F0           MOVX    @DPTR,A
    484              }
    485              tempPtr += Z_EXTADDR_LEN;
   \                     ??MT_AfIncomingMsg_4:
   \   0000BE   EE           MOV     A,R6
   \   0000BF   2408         ADD     A,#0x8
   \   0000C1   FE           MOV     R6,A
   \   0000C2   EF           MOV     A,R7
   \   0000C3   3400         ADDC    A,#0x0
   \   0000C5   FF           MOV     R7,A
    486          
    487              *tempPtr++ = pMsg->srcAddr.endPoint;
   \   0000C6   E5..         MOV     A,?V0 + 0
   \   0000C8   12....       LCALL   ?Subroutine6 & 0xFFFF
    488          #if defined INTER_PAN
    489              *tempPtr++ = LO_UINT16(pMsg->srcAddr.panId);
    490              *tempPtr++ = HI_UINT16(pMsg->srcAddr.panId);
    491          #else
    492              *tempPtr++ = 0;
   \                     ??CrossCallReturnLabel_41:
   \   0000CB   E4           CLR     A
   \   0000CC   F0           MOVX    @DPTR,A
   \   0000CD   A3           INC     DPTR
    493              *tempPtr++ = 0;
   \   0000CE   F0           MOVX    @DPTR,A
   \   0000CF   A3           INC     DPTR
   \   0000D0   0E           INC     R6
   \   0000D1   0E           INC     R6
   \   0000D2   800D         SJMP    ??CrossCallReturnLabel_42
    494          #endif
    495            }
    496            else
    497            {
    498              /* Source Address */
    499              *tempPtr++ = LO_UINT16(pMsg->srcAddr.addr.shortAddr);
   \                     ??MT_AfIncomingMsg_2:
   \   0000D4   E5..         MOV     A,?V0 + 0
   \   0000D6   2406         ADD     A,#0x6
   \   0000D8   12....       LCALL   ?Subroutine3 & 0xFFFF
    500              *tempPtr++ = HI_UINT16(pMsg->srcAddr.addr.shortAddr);
    501          
    502              /* Source EP */
    503              *tempPtr++ = pMsg->srcAddr.endPoint;
    504            }
   \                     ??CrossCallReturnLabel_4:
   \   0000DB   12....       LCALL   ??Subroutine26_0 & 0xFFFF
   \                     ??CrossCallReturnLabel_56:
   \   0000DE   12....       LCALL   ?Subroutine6 & 0xFFFF
   \                     ??CrossCallReturnLabel_42:
   \   0000E1   0E           INC     R6
   \   0000E2   AF83         MOV     R7,DPH
    505          
    506            /* Destination EP */
    507            *tempPtr++ = pMsg->endPoint;
   \   0000E4   E5..         MOV     A,?V0 + 0
   \   0000E6   2414         ADD     A,#0x14
   \   0000E8   12....       LCALL   ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_48:
   \   0000EB   12....       LCALL   ?Subroutine4 & 0xFFFF
    508          
    509            /* WasBroadCast */
    510            *tempPtr++ = pMsg->wasBroadcast;
   \                     ??CrossCallReturnLabel_6:
   \   0000EE   E5..         MOV     A,?V0 + 0
   \   0000F0   2415         ADD     A,#0x15
   \   0000F2   12....       LCALL   ?Subroutine1 & 0xFFFF
    511          
    512            /* LinkQuality */
    513            *tempPtr++ = pMsg->LinkQuality;
   \                     ??CrossCallReturnLabel_52:
   \   0000F5   2416         ADD     A,#0x16
   \   0000F7   12....       LCALL   ?Subroutine1 & 0xFFFF
    514          
    515            /* SecurityUse */
    516            *tempPtr++ = pMsg->SecurityUse;
   \                     ??CrossCallReturnLabel_53:
   \   0000FA   2419         ADD     A,#0x19
   \   0000FC   12....       LCALL   ?Subroutine1 & 0xFFFF
    517          
    518            /* Timestamp */
    519            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 0);
   \                     ??CrossCallReturnLabel_54:
   \   0000FF   241A         ADD     A,#0x1a
   \   000101   FA           MOV     R2,A
   \   000102   E5..         MOV     A,?V0 + 1
   \   000104   3400         ADDC    A,#0x0
   \   000106   FB           MOV     R3,A
   \   000107   8A82         MOV     DPL,R2
   \   000109   8B83         MOV     DPH,R3
   \   00010B   78..         MOV     R0,#?V0 + 4
   \   00010D   12....       LCALL   ?L_MOV_X
   \   000110   12....       LCALL   ?Subroutine9 & 0xFFFF
    520            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 1);
   \                     ??CrossCallReturnLabel_37:
   \   000113   12....       LCALL   ?L_MOV_X
   \   000116   E5..         MOV     A,?V0 + 5
   \   000118   8E82         MOV     DPL,R6
   \   00011A   8F83         MOV     DPH,R7
   \   00011C   12....       LCALL   ??Subroutine23_0 & 0xFFFF
    521            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 2);
   \                     ??CrossCallReturnLabel_39:
   \   00011F   12....       LCALL   ?L_MOV_X
   \   000122   7410         MOV     A,#0x10
   \   000124   78..         MOV     R0,#?V0 + 4
   \   000126   12....       LCALL   ?UL_SHR
   \   000129   12....       LCALL   ?Subroutine9 & 0xFFFF
    522            *tempPtr++ = BREAK_UINT32(pMsg->timestamp, 3);
   \                     ??CrossCallReturnLabel_38:
   \   00012C   12....       LCALL   ?L_MOV_X
   \   00012F   7418         MOV     A,#0x18
   \   000131   78..         MOV     R0,#?V0 + 4
   \   000133   12....       LCALL   ?UL_SHR
   \   000136   8E82         MOV     DPL,R6
   \   000138   8F83         MOV     DPH,R7
   \   00013A   E5..         MOV     A,?V0 + 4
   \   00013C   F0           MOVX    @DPTR,A
   \   00013D   A3           INC     DPTR
   \   00013E   0E           INC     R6
   \   00013F   AF83         MOV     R7,DPH
    523          
    524            /* Transmit Sequence Number */
    525            *tempPtr++ = pMsg->cmd.TransSeqNumber;
   \   000141   E5..         MOV     A,?V0 + 0
   \   000143   241E         ADD     A,#0x1e
   \   000145   12....       LCALL   ??Subroutine24_0 & 0xFFFF
    526          
    527            /* Data Length */
    528            *tempPtr++ = dataLen;
   \                     ??CrossCallReturnLabel_40:
   \   000148   E5..         MOV     A,?V0 + 9
   \   00014A   F0           MOVX    @DPTR,A
   \   00014B   A3           INC     DPTR
   \   00014C   0E           INC     R6
   \   00014D   0E           INC     R6
   \   00014E   AF83         MOV     R7,DPH
    529          
    530            /* Data */
    531            if (dataLen)
   \   000150   6026         JZ      ??MT_AfIncomingMsg_5
    532            {
    533              osal_memcpy(tempPtr, pMsg->cmd.Data, dataLen);
   \   000152                ; Setup parameters for call to function osal_memcpy
   \   000152   E5..         MOV     A,?V0 + 0
   \   000154   2421         ADD     A,#0x21
   \   000156   12....       LCALL   ?Subroutine20 & 0xFFFF
    534            }
   \                     ??CrossCallReturnLabel_49:
   \   000159   E0           MOVX    A,@DPTR
   \   00015A   F5..         MOV     ?V0 + 4,A
   \   00015C   A3           INC     DPTR
   \   00015D   E0           MOVX    A,@DPTR
   \   00015E   F5..         MOV     ?V0 + 5,A
   \   000160   78..         MOV     R0,#?V0 + 4
   \   000162   12....       LCALL   ?PUSH_XSTACK_I_THREE
   \   000165   85....       MOV     ?V0 + 0,?V0 + 9
   \   000168   AC..         MOV     R4,?V0 + 0
   \   00016A   7D00         MOV     R5,#0x0
   \   00016C   EE           MOV     A,R6
   \   00016D   FA           MOV     R2,A
   \   00016E   EF           MOV     A,R7
   \   00016F   FB           MOV     R3,A
   \   000170   12....       LCALL   ??osal_memcpy?relay
   \   000173   7403         MOV     A,#0x3
   \   000175   12....       LCALL   ?DEALLOC_XSTACK8
    535          
    536            /* Build and send back the response */
    537            MT_BuildAndSendZToolResponse(((uint8)MT_RPC_CMD_AREQ|(uint8)MT_RPC_SYS_AF), cmd, respLen, pRsp);
   \                     ??MT_AfIncomingMsg_5:
   \   000178                ; Setup parameters for call to function MT_BuildAndSendZToolResponse
   \   000178   AC..         MOV     R4,?V0 + 2
   \   00017A   AD..         MOV     R5,?V0 + 3
   \   00017C   AB..         MOV     R3,?V0 + 10
   \   00017E   AA..         MOV     R2,?V0 + 8
   \   000180   7944         MOV     R1,#0x44
   \   000182   12....       LCALL   ??MT_BuildAndSendZToolResponse?relay
    538          
    539            /* Free memory */
    540            osal_mem_free(pRsp);
   \   000185                ; Setup parameters for call to function osal_mem_free
   \   000185   AA..         MOV     R2,?V0 + 2
   \   000187   AB..         MOV     R3,?V0 + 3
   \   000189   12....       LCALL   ??osal_mem_free?relay
    541          }
   \                     ??MT_AfIncomingMsg_1:
   \   00018C   7F0B         MOV     R7,#0xb
   \   00018E   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine11:
   \   000000   F8           MOV     R0,A
   \   000001   E5..         MOV     A,?V0 + 1
   \   000003   3400         ADDC    A,#0x0
   \   000005   F9           MOV     R1,A
   \   000006   8882         MOV     DPL,R0
   \   000008   8983         MOV     DPH,R1
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine9:
   \   000000   8E82         MOV     DPL,R6
   \   000002   8F83         MOV     DPH,R7
   \   000004   E5..         MOV     A,?V0 + 4
   \   000006                REQUIRE ??Subroutine23_0
   \   000006                ; // Fall through to label ??Subroutine23_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine23_0:
   \   000000   F0           MOVX    @DPTR,A
   \   000001   A3           INC     DPTR
   \   000002   0E           INC     R6
   \   000003   AF83         MOV     R7,DPH
   \   000005   8A82         MOV     DPL,R2
   \   000007   8B83         MOV     DPH,R3
   \   000009   78..         MOV     R0,#?V0 + 4
   \   00000B   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine6:
   \   000000   240F         ADD     A,#0xf
   \   000002                REQUIRE ??Subroutine24_0
   \   000002                ; // Fall through to label ??Subroutine24_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine24_0:
   \   000000   12....       LCALL   ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_51:
   \   000003   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_45:
   \   000006   A3           INC     DPTR
   \   000007   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine20:
   \   000000   F582         MOV     DPL,A
   \   000002   E5..         MOV     A,?V0 + 1
   \   000004                REQUIRE ??Subroutine25_0
   \   000004                ; // Fall through to label ??Subroutine25_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine25_0:
   \   000000   3400         ADDC    A,#0x0
   \   000002   F583         MOV     DPH,A
   \   000004   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine17:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   8E82         MOV     DPL,R6
   \   000003   8F83         MOV     DPH,R7
   \   000005   F0           MOVX    @DPTR,A
   \   000006   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine5:
   \   000000   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_58:
   \   000003   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine15:
   \   000000   E0           MOVX    A,@DPTR
   \   000001   8E82         MOV     DPL,R6
   \   000003   8F83         MOV     DPH,R7
   \   000005   F0           MOVX    @DPTR,A
   \   000006   A3           INC     DPTR
   \   000007   0E           INC     R6
   \   000008   AF83         MOV     R7,DPH
   \   00000A   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine4:
   \   000000   12....       LCALL   ?Subroutine17 & 0xFFFF
   \                     ??CrossCallReturnLabel_44:
   \   000003   A3           INC     DPTR
   \   000004   AE82         MOV     R6,DPL
   \   000006   AF83         MOV     R7,DPH
   \   000008   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine3:
   \   000000   08           INC     R0
   \   000001   08           INC     R0
   \   000002   E5..         MOV     A,?V0 + 1
   \   000004   3400         ADDC    A,#0x0
   \   000006   F9           MOV     R1,A
   \   000007   8882         MOV     DPL,R0
   \   000009   8983         MOV     DPH,R1
   \   00000B   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_57:
   \   00000E   8882         MOV     DPL,R0
   \   000010   8983         MOV     DPH,R1
   \   000012   A3           INC     DPTR
   \   000013   22           RET

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ?Subroutine1:
   \   000000   12....       LCALL   ?Subroutine20 & 0xFFFF
   \                     ??CrossCallReturnLabel_50:
   \   000003                REQUIRE ??Subroutine26_0
   \   000003                ; // Fall through to label ??Subroutine26_0

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
   \                     ??Subroutine26_0:
   \   000000   12....       LCALL   ?Subroutine15 & 0xFFFF
   \                     ??CrossCallReturnLabel_59:
   \   000003   E5..         MOV     A,?V0 + 0
   \   000005   22           RET

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfCommandProcessing?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfCommandProcessing

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfRegister?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfRegister

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataRequest?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataRequest

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataRequestSrcRtg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataRequestSrcRtg

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfDataConfirm?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfDataConfirm

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??MT_AfIncomingMsg?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    MT_AfIncomingMsg
    542          
    543          /***************************************************************************************************
    544          ***************************************************************************************************/

   Maximum stack usage in bytes:

     Function                       ISTACK PSTACK XSTACK
     --------                       ------ ------ ------
     MT_AfCommandProcessing             0      0      9
       -> MT_AfRegister                 0      0     18
       -> MT_AfDataRequest              0      0     18
       -> MT_AfDataRequestSrcRtg        0      0     18
     MT_AfDataConfirm                   3      0      3
       -> MT_BuildAndSendZToolResponse
                                        4      0      6
     MT_AfDataRequest                   1      0     46
       -> osal_memcpy                   0      0     62
       -> afFindEndPointDesc            0      0     56
       -> AF_DataRequest                0      0     74
       -> MT_BuildAndSendZToolResponse
                                        0      0     56
     MT_AfDataRequestSrcRtg             1      0     55
       -> osal_memset                   0      0     68
       -> afFindEndPointDesc            0      0     68
       -> osal_mem_alloc                0      0     68
       -> AF_DataRequestSrcRtg          0      0     92
       -> osal_mem_free                 0      0     68
       -> MT_BuildAndSendZToolResponse
                                        0      0     68
     MT_AfIncomingMsg                   1      0     22
       -> osal_mem_alloc                0      0     38
       -> osal_memcpy                   0      0     44
       -> osal_memcpy                   0      0     44
       -> MT_BuildAndSendZToolResponse
                                        0      0     38
       -> osal_mem_free                 0      0     38
     MT_AfRegister                      1      0     24
       -> osal_mem_alloc                0      0     30
       -> MT_BuildEndpointDesc          0      0     30
       -> afRegister                    0      0     30
       -> osal_mem_free                 0      0     30
       -> MT_BuildAndSendZToolResponse
                                        0      0     30


   Segment part sizes:

     Function/Label                 Bytes
     --------------                 -----
     MT_AfCommandProcessing           51
     MT_AfRegister                   131
     ?Subroutine0                      8
     ?Subroutine18                     7
     ?Subroutine14                     6
     MT_AfDataRequest                391
     ?Subroutine10                     4
     ??Subroutine22_0                 15
     ?Subroutine8                     10
     ?Subroutine19                     9
     ?Subroutine7                      6
     ?Subroutine16                     7
     ?Subroutine2                      7
     MT_AfDataRequestSrcRtg          395
     ?Subroutine13                     7
     ?Subroutine12                     5
     ?Subroutine21                    10
     MT_AfDataConfirm                 80
     MT_AfIncomingMsg                401
     ?Subroutine11                    11
     ?Subroutine9                      6
     ??Subroutine23_0                 12
     ?Subroutine6                      2
     ??Subroutine24_0                  8
     ?Subroutine20                     4
     ??Subroutine25_0                  5
     ?Subroutine17                     7
     ?Subroutine5                      4
     ?Subroutine15                    11
     ?Subroutine4                      9
     ?Subroutine3                     20
     ?Subroutine1                      3
     ??Subroutine26_0                  6
     ??MT_AfCommandProcessing?relay    6
     ??MT_AfRegister?relay             6
     ??MT_AfDataRequest?relay          6
     ??MT_AfDataRequestSrcRtg?relay    6
     ??MT_AfDataConfirm?relay          6
     ??MT_AfIncomingMsg?relay          6

 
 1 658 bytes in segment BANKED_CODE
    36 bytes in segment BANK_RELAYS
 
 1 694 bytes of CODE memory

Errors: none
Warnings: none
