###############################################################################
#                                                                             #
# IAR C/C++ Compiler V8.10.3.10338/W32 for 8051         30/Mar/2018  16:46:35 #
# Copyright 2004-2011 IAR Systems AB.                                         #
#                                                                             #
#    Core               =  plain                                              #
#    Code model         =  banked                                             #
#    Data model         =  large                                              #
#    Calling convention =  xdata reentrant                                    #
#    Constant location  =  data_rom                                           #
#    Dptr setup         =  1,16                                               #
#    Source file        =  D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\Source\Bluetooth.c                  #
#    Command line       =  -f D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\..\..\..\Tools\CC2530DB #
#                          \f8wCoord.cfg (-DCPU32MHZ -DROOT=__near_func       #
#                          -DMAC_CFG_APP_PENDING_QUEUE=TRUE                   #
#                          -DMAC_CFG_TX_DATA_MAX=5 -DMAC_CFG_TX_MAX=8         #
#                          -DMAC_CFG_RX_MAX=5 -DZDO_COORDINATOR -DRTR_NWK)    #
#                          -f D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\..\..\..\Tools\CC2530DB #
#                          \f8wConfig.cfg (-DZIGBEEPRO -DSECURE=0             #
#                          -DZG_SECURE_DYNAMIC=0 -DREFLECTOR                  #
#                          -DDEFAULT_CHANLIST=0x00000800                      #
#                          -DZDAPP_CONFIG_PAN_ID=0xFFF1                       #
#                          -DNWK_START_DELAY=100 -DEXTENDED_JOINING_RANDOM_MA #
#                          SK=0x007F -DBEACON_REQUEST_DELAY=100               #
#                          -DBEACON_REQ_DELAY_MASK=0x00FF                     #
#                          -DLINK_STATUS_JITTER_MASK=0x007F                   #
#                          -DROUTE_EXPIRY_TIME=30 -DAPSC_ACK_WAIT_DURATION_PO #
#                          LLED=3000 -DNWK_INDIRECT_MSG_TIMEOUT=7             #
#                          -DMAX_RREQ_ENTRIES=8 -DAPSC_MAX_FRAME_RETRIES=3    #
#                          -DNWK_MAX_DATA_RETRIES=2                           #
#                          -DMAX_POLL_FAILURE_RETRIES=2 -DMAX_BCAST=9         #
#                          -DAPS_MAX_GROUPS=16 -DMAX_RTG_ENTRIES=40           #
#                          -DNWK_MAX_BINDING_ENTRIES=4                        #
#                          -DMAX_BINDING_CLUSTER_IDS=4 "-DDEFAULT_KEY={0x01,  #
#                          0x03, 0x05, 0x07, 0x09, 0x0B, 0x0D, 0x0F, 0x00,    #
#                          0x02, 0x04, 0x06, 0x08, 0x0A, 0x0C, 0x0D}"         #
#                          -DMAC_MAX_FRAME_SIZE=116                           #
#                          -DZDNWKMGR_MIN_TRANSMISSIONS=20 "-DCONST=const     #
#                          __code" -DGENERIC=__generic                        #
#                          -DRFD_RCVC_ALWAYS_ON=TRUE -DPOLL_RATE=1000         #
#                          -DQUEUED_POLL_RATE=100 -DRESPONSE_POLL_RATE=100)   #
#                          -DREJOIN_POLL_RATE=440 D:\ProgramData\Hardware\zig #
#                          bee\Projects\zstack\Samples\SensorSys\Source\Bluet #
#                          ooth.c -D HOLD_AUTO_START -D BUILD_ALL_DEVICES -D  #
#                          REFLECTOR -D NV_INIT -D xNV_RESTORE -D xZTOOL_P1   #
#                          -D xMT_TASK -D xMT_SYS_FUNC -D xMT_SAPI_FUNC -D    #
#                          xMT_SAPI_CB_FUNC -lC D:\ProgramData\Hardware\zigbe #
#                          e\Projects\zstack\Samples\SensorSys\CC2530DB\Coord #
#                          inatorEB\List\ -lA D:\ProgramData\Hardware\zigbee\ #
#                          Projects\zstack\Samples\SensorSys\CC2530DB\Coordin #
#                          atorEB\List\ --diag_suppress Pe001,Pa010 -o        #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\CoordinatorEB\Obj\ -e      #
#                          --no_code_motion --debug --core=plain --dptr=16,1  #
#                          --data_model=large --code_model=banked             #
#                          --calling_convention=xdata_reentrant               #
#                          --place_constants=data_rom --nr_virtual_regs 16    #
#                          -I D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\ -I                     #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\Source\ -I              #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\ZMain\TI2530DB\   #
#                          -I D:\ProgramData\Hardware\zigbee\Projects\zstack\ #
#                          Samples\SensorSys\CC2530DB\..\..\..\..\..\Componen #
#                          ts\hal\include\ -I D:\ProgramData\Hardware\zigbee\ #
#                          Projects\zstack\Samples\SensorSys\CC2530DB\..\..\. #
#                          .\..\..\Components\hal\target\CC2530EB\ -I         #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          mac\include\ -I D:\ProgramData\Hardware\zigbee\Pro #
#                          jects\zstack\Samples\SensorSys\CC2530DB\..\..\..\. #
#                          .\..\Components\mac\high_level\ -I                 #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          mac\low_level\srf04\ -I D:\ProgramData\Hardware\zi #
#                          gbee\Projects\zstack\Samples\SensorSys\CC2530DB\.. #
#                          \..\..\..\..\Components\mac\low_level\srf04\single #
#                          _chip\ -I D:\ProgramData\Hardware\zigbee\Projects\ #
#                          zstack\Samples\SensorSys\CC2530DB\..\..\..\..\..\C #
#                          omponents\mt\ -I D:\ProgramData\Hardware\zigbee\Pr #
#                          ojects\zstack\Samples\SensorSys\CC2530DB\..\..\..\ #
#                          ..\..\Components\osal\include\ -I                  #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          services\saddr\ -I D:\ProgramData\Hardware\zigbee\ #
#                          Projects\zstack\Samples\SensorSys\CC2530DB\..\..\. #
#                          .\..\..\Components\services\sdata\ -I              #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\af\ -I D:\ProgramData\Hardware\zigbee\Projec #
#                          ts\zstack\Samples\SensorSys\CC2530DB\..\..\..\..\. #
#                          .\Components\stack\nwk\ -I                         #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\sapi\ -I D:\ProgramData\Hardware\zigbee\Proj #
#                          ects\zstack\Samples\SensorSys\CC2530DB\..\..\..\.. #
#                          \..\Components\stack\sec\ -I                       #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          stack\sys\ -I D:\ProgramData\Hardware\zigbee\Proje #
#                          cts\zstack\Samples\SensorSys\CC2530DB\..\..\..\..\ #
#                          ..\Components\stack\zdo\ -I                        #
#                          D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\..\..\..\..\..\Components\ #
#                          zmac\ -I D:\ProgramData\Hardware\zigbee\Projects\z #
#                          stack\Samples\SensorSys\CC2530DB\..\..\..\..\..\Co #
#                          mponents\zmac\f8w\ -Ohz --require_prototypes       #
#    List file          =  D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\CoordinatorEB\List\Bluetoo #
#                          th.lst                                             #
#    Object file        =  D:\ProgramData\Hardware\zigbee\Projects\zstack\Sam #
#                          ples\SensorSys\CC2530DB\CoordinatorEB\Obj\Bluetoot #
#                          h.r51                                              #
#                                                                             #
#                                                                             #
###############################################################################

D:\ProgramData\Hardware\zigbee\Projects\zstack\Samples\SensorSys\Source\Bluetooth.c
      1          /*********************************************************************
      2           * INCLUDES
      3           */
      4          #include "AF.h"
      5          #include "ZDObject.h"
      6          #include "ZDProfile.h"
      7          
      8          #include "SensorSys_Coor.h"
      9          #include "device.h"
     10          #include "Bluetooth.h"
     11          #include "DebugTrace.h"
     12          
     13          #if !defined( WIN32 )
     14            #include "OnBoard.h"
     15          #endif
     16          
     17          /* HAL */
     18          #include "hal_led.h"
     19          #include "hal_uart.h"
     20          
     21          #include "nwk.h"
     22          
     23          #include "APS.h"
     24          #include "ZDApp.h"
     25          #include "OSAL.h"
     26          #include "OSAL_Tasks.h"
     27          #include "ZComDef.h"
     28          #include "hal_drivers.h"
     29          /*********************************************************************
     30           * MACROS
     31           */
     32          
     33          /*********************************************************************
     34           * CONSTANTS
     35           */
     36          
     37          /*********************************************************************
     38           * TYPEDEFS
     39           */
     40          
     41          /*********************************************************************
     42           * GLOBAL VARIABLES
     43           */

   \                                 In  segment XDATA_Z, align 1, keep-with-next
     44          uint8 uartbuf[20];
   \                     uartbuf:
   \   000000                DS 20
   \   000014                REQUIRE __INIT_XDATA_Z
     45          
     46          /*********************************************************************
     47           * LOCAL VARIABLES
     48           */
     49          static void rxCB(uint8 port,uint8 event);
     50          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     51          void BluetoothInit(void)
   \                     BluetoothInit:
     52          {
   \   000000   C082         PUSH    DPL
   \   000002   C083         PUSH    DPH
   \   000004                ; Saved register size: 2
   \   000004                ; Auto size: 29
   \   000004   74E3         MOV     A,#-0x1d
   \   000006   12....       LCALL   ?ALLOC_XSTACK8
     53              HalUARTInit();
   \   000009                ; Setup parameters for call to function HalUARTInit
   \   000009   12....       LCALL   ??HalUARTInit?relay
     54              halUARTCfg_t uartConfig;
     55              
     56              uartConfig.configured=TRUE;
   \   00000C   85..82       MOV     DPL,?XSP + 0
   \   00000F   85..83       MOV     DPH,?XSP + 1
   \   000012   7401         MOV     A,#0x1
   \   000014   F0           MOVX    @DPTR,A
     57              uartConfig.baudRate = HAL_UART_BR_9600;
   \   000015   12....       LCALL   ?XSTACK_DISP0_8
   \   000018   E4           CLR     A
   \   000019   F0           MOVX    @DPTR,A
     58              uartConfig.flowControl = FALSE;
   \   00001A   7402         MOV     A,#0x2
   \   00001C   12....       LCALL   ?XSTACK_DISP0_8
   \   00001F   E4           CLR     A
   \   000020   F0           MOVX    @DPTR,A
     59              uartConfig.callBackFunc = rxCB;
   \   000021   741B         MOV     A,#0x1b
   \   000023   12....       LCALL   ?XSTACK_DISP0_8
   \   000026   74..         MOV     A,#??rxCB?relay & 0xff
   \   000028   F0           MOVX    @DPTR,A
   \   000029   A3           INC     DPTR
   \   00002A   74..         MOV     A,#(??rxCB?relay >> 8) & 0xff
   \   00002C   F0           MOVX    @DPTR,A
     60          
     61              HalUARTOpen(0,&uartConfig);
   \   00002D                ; Setup parameters for call to function HalUARTOpen
   \   00002D   85..82       MOV     DPL,?XSP + 0
   \   000030   85..83       MOV     DPH,?XSP + 1
   \   000033   AA82         MOV     R2,DPL
   \   000035   AB83         MOV     R3,DPH
   \   000037   7900         MOV     R1,#0x0
   \   000039   12....       LCALL   ??HalUARTOpen?relay
     62              
     63          //    HalUARTWrite(0,uartbuf,16);
     64          }
   \   00003C   741D         MOV     A,#0x1d
   \   00003E   12....       LCALL   ?DEALLOC_XSTACK8
   \   000041   D083         POP     DPH
   \   000043   D082         POP     DPL
   \   000045   02....       LJMP    ?BRET
     65          

   \                                 In  segment BANKED_CODE, align 1, keep-with-next
     66          static void rxCB(uint8 port,uint8 event)
   \                     rxCB:
     67          {
   \   000000   74F7         MOV     A,#-0x9
   \   000002   12....       LCALL   ?BANKED_ENTER_XDATA
   \   000005                ; Saved register size: 9
   \   000005                ; Auto size: 0
   \   000005   EA           MOV     A,R2
   \   000006   FE           MOV     R6,A
     68          
     69              if(event & (HAL_UART_RX_FULL | HAL_UART_RX_ABOUT_FULL | HAL_UART_RX_TIMEOUT))
   \   000007   7407         MOV     A,#0x7
   \   000009   5E           ANL     A,R6
   \   00000A   6012         JZ      ??rxCB_0
     70              {
     71                  HalUARTRead(0, uartbuf, Hal_UART_RxBufLen(0));
   \   00000C                ; Setup parameters for call to function HalUARTRead
   \   00000C                ; Setup parameters for call to function Hal_UART_RxBufLen
   \   00000C   7900         MOV     R1,#0x0
   \   00000E   12....       LCALL   ??Hal_UART_RxBufLen?relay
   \   000011   EA           MOV     A,R2
   \   000012   FC           MOV     R4,A
   \   000013   EB           MOV     A,R3
   \   000014   FD           MOV     R5,A
   \   000015   7A..         MOV     R2,#uartbuf & 0xff
   \   000017   7B..         MOV     R3,#(uartbuf >> 8) & 0xff
   \   000019   7900         MOV     R1,#0x0
   \   00001B   12....       LCALL   ??HalUARTRead?relay
     72              }
     73          }
   \                     ??rxCB_0:
   \   00001E   7F01         MOV     R7,#0x1
   \   000020   02....       LJMP    ?BANKED_LEAVE_XDATA

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??BluetoothInit?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    BluetoothInit

   \                                 In  segment BANK_RELAYS, align 1
   \                     ??rxCB?relay:
   \   000000   12....       LCALL   ?BDISPATCH
   \   000003   ......       DC24    rxCB

   Maximum stack usage in bytes:

     Function               ISTACK PSTACK XSTACK
     --------               ------ ------ ------
     BluetoothInit              2      0     29
       -> HalUARTInit           4      0     58
       -> HalUARTOpen           4      0     58
     rxCB                       0      0      9
       -> Hal_UART_RxBufLen     0      0     18
       -> HalUARTRead           0      0     18


   Segment part sizes:

     Function/Label        Bytes
     --------------        -----
     uartbuf                 20
     BluetoothInit           72
     rxCB                    35
     ??BluetoothInit?relay    6
     ??rxCB?relay             6

 
 107 bytes in segment BANKED_CODE
  12 bytes in segment BANK_RELAYS
  20 bytes in segment XDATA_Z
 
 119 bytes of CODE  memory
  20 bytes of XDATA memory

Errors: none
Warnings: none
